!function(h){h.fn.justifiedGallery=function(n){var s={sizeRangeSuffixes:{lt100:"_t",lt240:"_m",lt320:"_n",lt500:"",lt640:"_z",lt1024:"_b"},rowHeight:120,maxRowHeight:0,margins:1,lastRow:"nojustify",justifyThreshold:.35,cssAnimation:!1,captionsAnimationDuration:500,captionsVisibleOpacity:.7,imagesAnimationDuration:300,fixedHeight:!1,captions:!0,rel:null,target:null,extension:/\.[^.]+$/,refreshTime:250,randomize:!1};function f(t){var e=h(t.currentTarget).find(".caption");t.data.settings.cssAnimation?e.addClass("caption-visible").removeClass("caption-hidden"):e.stop().fadeTo(t.data.settings.captionsAnimationDuration,t.data.settings.captionsVisibleOpacity)}function u(t){var e=h(t.currentTarget).find(".caption");t.data.settings.cssAnimation?e.removeClass("caption-visible").removeClass("caption-hidden"):e.stop().fadeTo(t.data.settings.captionsAnimationDuration,0)}function r(t,e,i,n,s,a,o){var r=t.find("img");r.css("width",n),r.css("height",s),r.css("margin-left",-n/2),r.css("margin-top",-s/2),t.width(n),t.height(a),t.css("top",i),t.css("left",e),t.addClass("entry-visible");var g=t.data("jg.captionMouseEvents");if(!0===o.settings.captions){var l=t.find(".caption");if(0===l.length){var d=r.attr("alt");void 0===d&&(d=t.attr("title")),void 0!==d&&(l=h('<div class="caption">'+d+"</div>"),t.append(l))}0!==l.length&&void 0===g&&(g={mouseenter:f,mouseleave:u},t.on("mouseenter",void 0,o,g.mouseenter),t.on("mouseleave",void 0,o,g.mouseleave),t.data("jg.captionMouseEvents",g))}else void 0!==g&&(t.off("mouseenter",void 0,o,g.mouseenter),t.off("mouseleave",void 0,o,g.mouseleave),t.removeData("jg.captionMouseEvents"))}function a(t){t.lastAnalyzedIndex=-1,t.buildingRow.entriesBuff=[],t.buildingRow.width=0,t.offY=0,t.firstRowFlushed=!1}function g(t,e){var i,n,s,a=0;if(s=function(t,e){var i,n,s,a,o,r,g=!0,l=0,d=t.galleryWidth,f=d-t.buildingRow.width-(t.buildingRow.entriesBuff.length-1)*t.settings.margins;if(e&&"hide"===t.settings.lastRow&&f/d>t.settings.justifyThreshold){for(i=0;i<t.buildingRow.entriesBuff.length;i++)n=t.buildingRow.entriesBuff[i],t.settings.cssAnimation?n.removeClass("entry-visible"):n.stop().fadeTo(0,0);return-1}for(e&&"nojustify"===t.settings.lastRow&&f/d>t.settings.justifyThreshold&&(g=!1),i=0;i<t.buildingRow.entriesBuff.length;i++)s=t.buildingRow.entriesBuff[i].find("img"),a=Math.ceil(s.data("jg.imgw")/(s.data("jg.imgh")/t.settings.rowHeight)),g?(o=i<t.buildingRow.entriesBuff.length-1?a+Math.ceil(a/t.buildingRow.width*f):d,r=Math.ceil(t.settings.rowHeight*(o/a)),t.settings.fixedHeight&&r<t.settings.rowHeight&&(o=a,r=t.settings.rowHeight)):(o=a,r=t.settings.rowHeight),s.data("jg.imgw",o),s.data("jg.imgh",r),d-=o+(i<t.buildingRow.entriesBuff.length-1?t.settings.margins:0),(0===i||r<l)&&(l=r);return t.settings.fixedHeight&&(l=t.settings.rowHeight),l}(t,e),e&&"hide"===t.settings.lastRow&&-1===s)return t.buildingRow.entriesBuff=[],void(t.buildingRow.width=0);0<t.settings.maxRowHeight&&t.settings.maxRowHeight<s?s=t.settings.maxRowHeight:0===t.settings.maxRowHeight&&1.5*t.settings.rowHeight<s&&(s=1.5*t.settings.rowHeight);for(var o=0;o<t.buildingRow.entriesBuff.length;o++)n=(i=t.buildingRow.entriesBuff[o]).find("img"),r(i,a,t.offY,n.data("jg.imgw"),n.data("jg.imgh"),s,t),a+=n.data("jg.imgw")+t.settings.margins;t.$gallery.height(t.offY+s+(t.spinner.active?t.spinner.$el.innerHeight():0)),e||(t.offY+=s+t.settings.margins,t.buildingRow.entriesBuff=[],t.buildingRow.width=0,t.firstRowFlushed=!0,t.$gallery.trigger("jg.rowflush"))}function l(t){t.yield.flushed=0,null!==t.imgAnalyzerTimeout&&clearTimeout(t.imgAnalyzerTimeout)}function d(t,e){l(t),t.imgAnalyzerTimeout=setTimeout(function(){i(t,e)},.001),i(t,e)}function i(t,e){for(var i,n=t.lastAnalyzedIndex+1;n<t.entries.length;n++){var s=h(t.entries[n]),a=s.find("img");if(!0===a.data("jg.loaded")){var o=Math.ceil(a.data("jg.imgw")/(a.data("jg.imgh")/t.settings.rowHeight));if(i=t.firstRowFlushed&&n>=t.entries.length-1,t.buildingRow.width+(t.settings.fixedHeight?o:o/2)+(t.buildingRow.entriesBuff.length-1)*t.settings.margins>t.galleryWidth&&(g(t,i),++t.yield.flushed>=t.yield.every))return void d(t,e);t.buildingRow.entriesBuff.push(s),t.buildingRow.width+=o,t.lastAnalyzedIndex=n}else if("error"!==a.data("jg.loaded"))return}0<t.buildingRow.entriesBuff.length&&g(t,t.firstRowFlushed),t.spinner.active&&(t.spinner.active=!1,t.$gallery.height(t.$gallery.height()-t.spinner.$el.innerHeight()),t.spinner.$el.detach(),function(t){clearInterval(t.intervalId),t.intervalId=null}(t.spinner)),l(t),e?t.$gallery.trigger("jg.resize"):t.$gallery.trigger("jg.complete")}return this.each(function(t,e){var r=h(e);r.addClass("justified-gallery");var g=r.data("jg.context");if(void 0===g){if(null!=n&&"object"!=typeof n)throw"The argument must be an object";var i=h('<div class="spinner"><span></span><span></span><span></span></div>');g={settings:h.extend({},s,n),imgAnalyzerTimeout:null,entries:null,buildingRow:{entriesBuff:[],width:0},lastAnalyzedIndex:-1,firstRowFlushed:!1,yield:{every:2,flushed:0},offY:0,spinner:{active:!1,phase:0,timeslot:150,$el:i,$points:i.find("span"),intervalId:null},checkWidthIntervalId:null,galleryWidth:r.width(),$gallery:r},r.data("jg.context",g)}else"norewind"===n||(g.settings=h.extend({},g.settings,n),a(g));if(function(e){function t(t){if("string"!=typeof e.settings.sizeRangeSuffixes[t])throw"sizeRangeSuffixes."+t+" must be a string"}function i(t){if("string"==typeof e.settings[t]){if(e.settings[t]=parseFloat(e.settings[t],10),isNaN(e.settings[t]))throw"invalid number for "+t}else{if("number"!=typeof e.settings[t])throw t+" must be a number";if(isNaN(e.settings[t]))throw"invalid number for "+t}}if("object"!=typeof e.settings.sizeRangeSuffixes)throw"sizeRangeSuffixes must be defined and must be an object";if(t("lt100"),t("lt240"),t("lt320"),t("lt500"),t("lt640"),t("lt1024"),i("rowHeight"),i("maxRowHeight"),i("margins"),"nojustify"!==e.settings.lastRow&&"justify"!==e.settings.lastRow&&"hide"!==e.settings.lastRow)throw'lastRow must be "nojustify", "justify" or "hide"';if(i("justifyThreshold"),e.settings.justifyThreshold<0||1<e.settings.justifyThreshold)throw"justifyThreshold must be in the interval [0,1]";if("boolean"!=typeof e.settings.cssAnimation)throw"cssAnimation must be a boolean";if(i("captionsAnimationDuration"),i("imagesAnimationDuration"),i("captionsVisibleOpacity"),e.settings.captionsVisibleOpacity<0||1<e.settings.captionsVisibleOpacity)throw"captionsVisibleOpacity must be in the interval [0,1]";if("boolean"!=typeof e.settings.fixedHeight)throw"fixedHeight must be a boolean";if("boolean"!=typeof e.settings.captions)throw"captions must be a boolean";if(i("refreshTime"),"boolean"!=typeof e.settings.randomize)throw"randomize must be a boolean"}(g),g.entries=r.find("> a, > div").toArray(),0!==g.entries.length){g.settings.randomize&&(g.entries.sort(function(){return 2*Math.random()-1}),h.each(g.entries,function(){h(this).appendTo(r)})),g.usedSizeRangeRegExp=new RegExp("("+g.settings.sizeRangeSuffixes.lt100+"|"+g.settings.sizeRangeSuffixes.lt240+"|"+g.settings.sizeRangeSuffixes.lt320+"|"+g.settings.sizeRangeSuffixes.lt500+"|"+g.settings.sizeRangeSuffixes.lt640+"|"+g.settings.sizeRangeSuffixes.lt1024+")$"),0<g.settings.maxRowHeight&&g.settings.maxRowHeight<g.settings.rowHeight&&(g.settings.maxRowHeight=g.settings.rowHeight);var l=!1;h.each(g.entries,function(t,e){var i=h(e),n=i.find("img");if(!0!==n.data("jg.loaded")){n.data("jg.loaded",!1),!(l=!0)===g.spinner.active&&(g.spinner.active=!0,r.append(g.spinner.$el),r.height(g.offY+g.spinner.$el.innerHeight()),function(t){clearInterval(t.intervalId),t.intervalId=setInterval(function(){t.phase<t.$points.length?t.$points.eq(t.phase).fadeTo(t.timeslot,1):t.$points.eq(t.phase-t.$points.length).fadeTo(t.timeslot,0),t.phase=(t.phase+1)%(2*t.$points.length)},t.timeslot)}(g.spinner)),null!==g.settings.rel&&i.attr("rel",g.settings.rel),null!==g.settings.target&&i.attr("target",g.settings.target);var s=void 0!==n.data("safe-src")?n.data("safe-src"):n.attr("src");n.data("jg.originalSrc",s),n.attr("src",s);var a=new Image,o=h(a);o.one("load",function(){n.off("load error"),n.data("jg.imgw",a.width),n.data("jg.imgh",a.height),n.data("jg.loaded",!0),d(g,!1)}),o.one("error",function(){n.off("load error"),n.data("jg.loaded","error"),d(g,!1)}),a.src=s}}),l||d(g,!1),function(e){e.checkWidthIntervalId=setInterval(function(){var t=parseInt(e.$gallery.width(),10);e.galleryWidth!==t&&(e.galleryWidth=t,a(e),d(e,!0))},e.settings.refreshTime)}(g)}})}}(jQuery);
//# sourceMappingURL=jquery.justifiedGallery.js.map
