{"version":3,"sources":["bbg_xiv-gallery.js"],"names":["bbg_xiv","window","docUrl","helpOptionsUrl","galleryOfGalleriesTitle","bbg_xiv_lang","templateOptions","evaluate","interpolate","escape","variable","images","search","galleries","Image","Backbone","Model","extend","idAttribute","Images","Collection","model","ImageView","View","render","srcOnly","html","this","template","attributes","$el","GalleryView","renderBootstrapGallery","container","collection","empty","ReactDOM","GalleryContainer","get","renderFlex","FlexContainer","guiInterface","find","addClass","renderTiles","flags","indexOf","Modernizr","objectfit","load","naturalWidth","naturalHeight","jQuery","galleryContainer","closest","attr","hover","hasClass","parents","each","show","hide","click","e","caption","parentNode","data","preventDefault","renderCarousel","id","containerWidth","width","imageView","_","bulletsHtml","imagesHtml","forEach","index","browser","bbg_xiv_container_width","galleryView","gallery","size","length","bullets","items","append","renderTabs","tabView","tabsHtml","tabs","renderDense","mode","titleView","titlesHtml","titles","renderJustified","justifiedContainer","$justifiedGallery","justifiedGallery","margins","rowHeight","bbg_xiv_miro_row_height","lastRow","refreshSensitivity","refreshTime","on","css","matchMedia","matches","removeClass","img","querySelector","item","addEventListener","style","display","opacity","stopImmediatePropagation","$caption","parseFloat","renderGeneric","fieldNames","dumpFieldNames","Object","keys","key","push","buffer","name","dumpFieldValues","renderTable","constructImages","constructed","renderGallery","view","dataset","concat","split","jqGallery","constructOverlay","outer","inner","$altInner","overlayShowing","overlayLocked","mouseX","NaN","mouseY","hideOverlay","type","Math","abs","screenX","screenY","$inner","$navbar","setTimeout","add","mousemove","call","fullImg","fullTitle","fullCaption","titleColor","titleShadow","color","textShadow","altOverlayView","showOverlay","$button","tagName","parent","alt","replace","galleryId","bbg_xivGalleryId","bbg_xivImageId","src","getSrc","bbg_srcset","srcset","getSrcset","removeAttribute","textContent","getTitle","getCaption","error","console","log","stopPropagation","pause","mouseenter","gallery_home","titlesButton","resize","carouselId","button","$carousel","carousel","$this","$span","open","resetGallery","prevChangeTime","input","slider","slideChange","val","change","Date","now","i","isNumeric","parseInt","keypress","which","blur","focus","relatedTarget","$gallery","$divCarousel","scrollTop","scrollHeight","height","offset","top","$body","$adminBar","adminBarHeight","outerHeight","bodyBeforeHeight","bodyBeforeStyle","getComputedStyle","position","interval","bbg_xiv_carousel_interval","prettifyTabs","href","substr","lastIndexOf","r0","j","f","w","h","W","H","r","max","floor","$window","fullscreen","$content","filter","galleryIndex","toggle","siblings","jqThis","bbg_xiv_flex_number_of_dense_view_columns","normal","highlight","background-color","border-color","bottom","div","li","checked","value","menuItems","bbg_xiv_flex_min_width_for_dense_view","galleryOfGalleries","models","gallery_index","divAltGalleryHeading","text","initial","navbar","currentView","divGallery","defaultView","getDefaultView","liSelectView","liFirst","toLowerCase","fullSize","icon","bandwidth","source_url","bbg_thumbnail_src","bbg_large_src","bbg_medium_large_src","bbg_medium_src","bbg_xiv_bandwidth","title","rendered","trim","noAlt","getAlt","noCaption","alt_text","getPostContent","postContent","bbg_post_content","getSizes","localStorage","setItem","removeItem","localStorageAvailable","setCookie","expires","d","setTime","getTime","document","cookie","toUTCString","getCookie","getItem","start","end","substring","calcBreakpoints","minFlexWidth","bbg_xiv_flex_min_width","breakpoints","cssClass","getOptionsFromCookie","options","JSON","parse","carousel_interval","flex_min_width","miro_row_height","max_search_results","bbg_xiv_max_search_results","flex_number_of_dense_view_columns","bbg_xiv_default_view","usingServerDefaultView","bbg_xiv_interface","userAgent","navigator","lowbandwidth","test","touchevents","wpRestApiMaxPerPage","pxWidth","minFlexWidthForCaption","bbg_xiv_flex_min_width_for_caption","breakpoint","ready","wp","api","loadPromise","done","collections","Media","reset","select","handleResponse","jqueryLoading","mobile","loading","children","detach","prop","liGallery","textVisible","textonly","_widget","undefined","specifiers","nameMap","ids","bb_tags","valueMap","ASC","DESC","match","parameters","specifier","orderby","first","once","per_page","fetch","success","c","Number","MAX_SAFE_INTEGER","query","page","pages","searchLimit","searchBtn","startSearch","continueSearch","history","prevQuery","heading","Page","of","o","link","xhr","getResponseHeader","state","totalObjects","totalPages","$galleryContainer","$container","$figure","divConfigure","attrMax","stringify","pageY","swipestop","coords","swipestart","zIndex"],"mappings":"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","file":"bbg_xiv-gallery.js","sourcesContent":["// Backbone.js Model View Presenter for the 'gallery' shortcode\n\n/*\n    This program is free software; you can redistribute it and/or\n    modify it under the terms of the GNU General Public License\n    as published by the Free Software Foundation; either version 2\n    of the License, or (at your option) any later version.\n\n    This program is distributed in the hope that it will be useful,\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n    GNU General Public License for more details.\n\n    You should have received a copy of the GNU General Public License\n    along with this program; if not, write to the Free Software\n    Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n\n    Copyright 2015  Magenta Cuda\n*/\n\n(function(){\n    var bbg_xiv=window.bbg_xiv=window.bbg_xiv||{};\n    // URLs\n    bbg_xiv.docUrl         = \"http://docs.magentacuda.com/\";\n    bbg_xiv.helpOptionsUrl = \"http://docs.magentacuda.com/#options\";\n    // Strings\n    bbg_xiv.galleryOfGalleriesTitle=bbg_xiv_lang.galleryOfGalleriesTitle;\n    // use WordPress templating syntax; see .../wp-includes/js/wp-util.js\n    bbg_xiv.templateOptions={\n        evaluate:    /<#([\\s\\S]+?)#>/g,\n        interpolate: /\\{\\{\\{([\\s\\S]+?)\\}\\}\\}/g,\n        escape:      /\\{\\{([^\\}]+?)\\}\\}(?!\\})/g,\n        variable:    'data'\n    };\n    \n    bbg_xiv.images    = {};\n    bbg_xiv.search    = {};   // state info for multi part search results\n    bbg_xiv.galleries = {};   // state info for alternate galleries\n    \n    bbg_xiv.Image     = Backbone.Model.extend( { idAttribute: \"id\" } );\n    \n    bbg_xiv.Images    = Backbone.Collection.extend( {model: bbg_xiv.Image } );\n    \n    bbg_xiv.ImageView = Backbone.View.extend( {\n        render:function(srcOnly){\n            var html=this.template(this.model.attributes);\n            if(srcOnly){\n                return html;\n            }\n            this.$el.html(html);\n            return this;\n        }    \n    });\n    \n    bbg_xiv.GalleryView=Backbone.View.extend({\n        render:function(){\n            var html=this.template(this.model.attributes);\n            this.$el.html(html);\n            return this;\n        }\n    });\n    \n    bbg_xiv.renderBootstrapGallery=function(container,collection){\n        var imageView=new bbg_xiv.ImageView();\n        // attach template to imageView not ImageView.prototype since template is specific to imageView\n/*\n        imageView.template=_.template( jQuery(\"script#bbg_xiv-template_gallery_item\").html(),null,bbg_xiv.templateOptions);\n        var imagesHtml=\"\";\n        collection.forEach(function(model,index){\n            imageView.model=model;\n            imagesHtml+=imageView.render(true);\n            // Bootstrap's grid needs \"clear\" elements to correctly align non-uniformly sized items\n            if(index%4===3){\n                imagesHtml+='<br class=\"clearfix visible-lg-block\">';\n            }\n            if(index%3===2){\n                imagesHtml+='<br class=\"clearfix visible-md-block\">';\n            }\n            if(index%2===1){\n                imagesHtml+='<br class=\"clearfix visible-sm-block\">';\n            }\n        } );\n        var galleryView=new bbg_xiv.GalleryView({\n            model:{\n                attributes:{\n                    items:imagesHtml\n                }\n            }\n        } );\n        galleryView.template=_.template(jQuery(\"script#bbg_xiv-template_gallery_container\").html(),null,bbg_xiv.templateOptions);\n        container.empty();\n        container.append(galleryView.render().$el.find(\"div.container\"));\n */\n        container.empty();\n        ReactDOM.render( GalleryContainer( collection ), container.get( 0 ) );\n    };\n\n    bbg_xiv.renderFlex=function(container,collection){\n/*\n        var containerWidth=container.width();\n        var imageView=new bbg_xiv.ImageView();\n        // attach template to imageView not ImageView.prototype since template is specific to imageView\n        imageView.template=_.template( jQuery(\"script#bbg_xiv-template_flex_item\").html(),null,bbg_xiv.templateOptions);\n        var imagesHtml=\"\";\n        collection.forEach(function( model ) {\n            model.attributes.bbg_xiv_container_width=containerWidth;\n            imageView.model=model;\n            imagesHtml+=imageView.render(true);\n        });\n        var galleryView=new bbg_xiv.GalleryView({\n            model:{\n                attributes:{\n                    id:collection.id,\n                    items:imagesHtml\n                }\n            }\n        });\n        galleryView.template=_.template(jQuery(\"script#bbg_xiv-template_flex_container\").html(),null,bbg_xiv.templateOptions);\n        container.empty();\n        container.append(galleryView.render().$el.find(\"div.bbg_xiv-flex_container\"));\n */ \n        container.empty();\n        ReactDOM.render(FlexContainer(collection),container.get(0));\n        if ( bbg_xiv.guiInterface === 'touch' ) {\n            container.find(\"div.bbg_xiv-flex_container div.bbg_xiv-flex_item div.bbg_xiv-dense_full_btn\").addClass(\"bbg_xiv-touch\");\n        }\n    };\n\n    bbg_xiv.renderTiles=function(container,collection,flags){\n        // gallery tiles have exactly the same HTML elements as the gallery Flex items but we will use CSS specificity to override the Flex container CSS\n        container.addClass(\"bbg_xiv-tiles_container\");\n        // in the default mode of the square tiles the images cover the square tiles i.e., object-fit: cover;\n        if(flags.indexOf(\"contain\")!==-1){\n            // the images in the square tiles are contained in the square tiles i.e., object-fit: contain;\n            container.addClass(\"bbg_xiv-contain\");\n        }else if(flags.indexOf(\"fill\")!==-1){\n            // object-fit: fill;\n            container.addClass(\"bbg_xiv-fill\");\n        }\n        bbg_xiv.renderFlex(container,collection);\n        if(!Modernizr.objectfit||flags.indexOf(\"contain\")!==-1){\n            // IE and Edge do not support objectfit so we set a class to differentiate between landscape and portrait mode which will let our CSS rules simulate object-fit:cover\n            container.find(\"div.bbg_xiv-flex_item img\").load(function(){\n                if(this.naturalWidth<this.naturalHeight){\n                    jQuery(this).addClass(\"bbg_xiv-portrait\");\n                }\n            });\n        }\n        var flexContainer    = container.find( 'div.bbg_xiv-flex_container');\n        var galleryContainer = flexContainer.closest( 'div.bbg_xiv-gallery' ).addClass( 'bbg_xiv-caption_visible' );\n        galleryContainer.find( 'button.bbg_xiv-titles' ).attr( 'title', bbg_xiv_lang['hide titles'] );\n        // flip display state of caption on hover\n        container.find(\"div.bbg_xiv-dense_full_btn\").hover(\n            function() {\n                if ( ! galleryContainer.hasClass( 'bbg_xiv-caption_visible' ) ) {\n                    jQuery(this).parents(\"div.bbg_xiv-flex_item\").find(\"figure figcaption\").each(function(){\n                        jQuery(this).show();\n                    });\n                }\n            },\n            function() {\n                if ( ! galleryContainer.hasClass( 'bbg_xiv-caption_visible' ) ) {\n                    jQuery(this).parents(\"div.bbg_xiv-flex_item\").find(\"figure figcaption\").each(function(){\n                        jQuery(this).hide();\n                    });\n                }\n            }\n        );\n        if ( bbg_xiv.guiInterface === 'touch' ) {\n            container.find(\"div.bbg_xiv-flex_item a\").click(function(e){\n                if ( ! galleryContainer.hasClass( 'bbg_xiv-caption_visible' ) ) {\n                    var caption=jQuery(this.parentNode).find(\"figure figcaption\");\n                    if(!caption.data(\"visible\")){\n                        container.find(\"div.bbg_xiv-flex_item figure figcaption\").data(\"visible\",false);\n                        caption.data(\"visible\",true);\n                        e.preventDefault();\n                    }\n                }\n            });\n        }\n    };\n\n    bbg_xiv.renderCarousel=function(container,collection,id){\n        var containerWidth=container.width();\n        var imageView=new bbg_xiv.ImageView();\n        imageView.template=_.template(jQuery(\"script#bbg_xiv-template_carousel_item\").html(),null,bbg_xiv.templateOptions);\n        var bulletsHtml=\"\";\n        var imagesHtml=\"\";\n        collection.forEach(function(model,index){\n            model.attributes.browser=bbg_xiv.browser;\n            model.attributes.index=index;\n            model.attributes.bbg_xiv_container_width=containerWidth;\n            imageView.model=model;\n            var active=index ===0?' class=\"active\"':'';\n            bulletsHtml+='<li data-target=\"#'+id+'\" data-slide-to=\"'+index+'\"'+active+'></li>';\n            imagesHtml+=imageView.render(true);\n        } );\n        var galleryView=new bbg_xiv.GalleryView({\n            model:{\n                attributes:{\n                    id:id,\n                    gallery:collection.id,\n                    size:collection.length,\n                    bullets:bulletsHtml,\n                    items:imagesHtml\n                }\n            }\n        } );\n        galleryView.template=_.template(jQuery(\"script#bbg_xiv-template_carousel_container\").html(),null,bbg_xiv.templateOptions);\n        container.empty();\n        container.append(galleryView.render().$el.find( \"div.carousel.slide\"));\n    };\n\n    bbg_xiv.renderTabs=function(container,collection,id){\n        var containerWidth=container.width();\n        var tabView=new bbg_xiv.ImageView();\n        tabView.template=_.template(jQuery(\"script#bbg_xiv-template_tabs_tab\").html(),null,bbg_xiv.templateOptions);\n        var imageView=new bbg_xiv.ImageView();\n        imageView.template=_.template(jQuery(\"script#bbg_xiv-template_tabs_item\").html(),null,bbg_xiv.templateOptions);\n        var tabsHtml=\"\";\n        var imagesHtml=\"\";\n        collection.forEach(function(model,index){\n            model.attributes.browser=bbg_xiv.browser;\n            model.attributes.index=index;\n            model.attributes.bbg_xiv_container_width=containerWidth;\n            imageView.model=tabView.model=model;\n            tabsHtml+=tabView.render(true);\n            imagesHtml+=imageView.render(true);\n        });\n        var galleryView=new bbg_xiv.GalleryView({\n            model:{\n                attributes:{\n                    id:id,\n                    tabs:tabsHtml,\n                    items:imagesHtml\n                }\n            }\n        });\n        galleryView.template=_.template(jQuery(\"script#bbg_xiv-template_tabs_container\").html(),null,bbg_xiv.templateOptions);\n        container.empty();\n        container.append(galleryView.render().$el.find(\"div.bbg_xiv-template_tabs_container\"));\n    };\n\n    bbg_xiv.renderDense=function(container,collection,id,mode){\n        var containerWidth=container.width();\n        var titleView=new bbg_xiv.ImageView();\n        titleView.template=_.template(jQuery(\"script#bbg_xiv-template_dense_title\").html(),null,bbg_xiv.templateOptions);\n        var imageView=new bbg_xiv.ImageView();\n        imageView.template=_.template(jQuery(\"script#bbg_xiv-template_dense_image\").html(),null,bbg_xiv.templateOptions);\n        var titlesHtml=\"\";\n        var imagesHtml=\"\";\n        collection.forEach(function(model,index){\n            model.attributes.mode=mode;\n            model.attributes.index=index;\n            model.attributes.bbg_xiv_container_width=containerWidth;\n            imageView.model=titleView.model=model;\n            titlesHtml+=titleView.render(true);\n            imagesHtml+=imageView.render(true);\n        });\n        var galleryView=new bbg_xiv.GalleryView({\n            model:{\n                attributes:{\n                    id:id,\n                    gallery:collection.id,\n                    mode:mode,\n                    titles:titlesHtml,\n                    images:imagesHtml\n                }\n            }\n        });\n        galleryView.template=_.template(jQuery(\"script#bbg_xiv-template_dense_container\").html(),null,bbg_xiv.templateOptions);\n        container.empty();\n        container.append(galleryView.render().$el.find(\"div.bbg_xiv-dense_container\"));\n    };\n    \n    bbg_xiv.renderJustified=function(container,collection){\n        var imageView=new bbg_xiv.ImageView();\n        // attach template to imageView not ImageView.prototype since template is specific to imageView\n        imageView.template=_.template( jQuery(\"script#bbg_xiv-template_justified_item\").html(),null,bbg_xiv.templateOptions);\n        var imagesHtml=\"\";\n        collection.forEach(function( model ) {\n            imageView.model=model;\n            imagesHtml+=imageView.render(true);\n        });\n        var galleryView=new bbg_xiv.GalleryView({\n            model:{\n                attributes:{\n                    id:collection.id,\n                    items:imagesHtml\n                }\n            }\n        });\n        galleryView.template=_.template(jQuery(\"script#bbg_xiv-template_justified_container\").html(),null,bbg_xiv.templateOptions);\n        container.empty();\n        var justifiedContainer=galleryView.render().$el.find(\"div.bbg_xiv-justified_container\");\n        container.append(justifiedContainer);\n        var $justifiedGallery = justifiedContainer.find( 'div.bbg_xiv-justified_gallery' );\n        $justifiedGallery.justifiedGallery({margins: 5, rowHeight: bbg_xiv.bbg_xiv_miro_row_height, lastRow: 'nojustify', refreshSensitivity: 0, refreshTime: 250 })\n            .on( 'jg.complete jg.resize', function() {\n            // Why are there negative margins on the img - anyway remove them\n            $justifiedGallery.find( 'img' ).css( 'margin', '0' );\n        });\n        if ( bbg_xiv.guiInterface === 'touch' ) {\n            justifiedContainer.addClass( 'bbg_xiv-touch' );\n            $justifiedGallery.find( 'div.bbg_xiv-justified_item > a' ).click(function( e ) {\n                e.preventDefault();\n            });\n            justifiedContainer.addClass( window.matchMedia( '(max-aspect-ratio:1/1)' ).matches ? 'bbg_xiv-portrait' : 'bbg_xiv-landscape' );\n        }\n        justifiedContainer   = container.find( 'div.bbg_xiv-justified_container' );\n        var galleryContainer = justifiedContainer.closest( 'div.bbg_xiv-gallery' ).removeClass( 'bbg_xiv-caption_visible' );\n        galleryContainer.find( 'button.bbg_xiv-titles' ).attr( 'title',  bbg_xiv_lang['show captions'] );\n        // if CC has been set to visible then override Justified Gallery's hover handlers\n        justifiedContainer.find(\"div.bbg_xiv-justified_gallery div.bbg_xiv-justified_item\").each(function(){\n          var img=this.querySelector(\"img\");\n          var caption=this.querySelector(\"div.caption\");\n          [img,caption].forEach(function(item){\n              // these handlers need work if executed before or after the Justified Gallery's handlers\n              item.addEventListener(\"mouseover\",function(e){\n                  if ( galleryContainer.hasClass( 'bbg_xiv-caption_visible' ) ) {\n                      caption.style.display=\"block\";\n                      caption.style.opacity=\"0.7\";\n                      e.stopImmediatePropagation();\n                  }\n              });\n              item.addEventListener(\"mouseout\",function(e){\n                  if ( galleryContainer.hasClass( 'bbg_xiv-caption_visible' ) ) {\n                      caption.style.display=\"block\";\n                      caption.style.opacity=\"0.7\";\n                      e.stopImmediatePropagation();\n                  }\n              });\n          });\n          jQuery( img ).closest( 'a' ).click(function( e ) {\n              e.preventDefault();\n          });\n          jQuery( caption ).find( 'a' ).click( function( e ) {\n              var $caption = jQuery( this ).closest( 'div.caption' );\n              if ( parseFloat( $caption.css( 'opacity' ) ) < 0.1 ) {\n                  e.preventDefault();\n              }\n          } );\n        });\n    };\n\n    // renderGeneric() may work unmodified with your template.\n    // Otherwise you can use it as a base for a render function specific to your template.\n    // See renderGallery(), renderCarousel() or renderTabs() - all of which need some special HTML to work correctly.\n\n    bbg_xiv.renderGeneric=function(container,collection,template){\n        var imageView=new bbg_xiv.ImageView();\n        // attach template to imageView not ImageView.prototype since template is specific to imageView\n        imageView.template=_.template( jQuery(\"script#bbg_xiv-template_\"+template+\"_item\").html(),null,bbg_xiv.templateOptions);\n        var imagesHtml=\"\";\n        collection.forEach(function( model ) {\n            imageView.model=model;\n            imagesHtml+=imageView.render(true);\n        });\n        var galleryView=new bbg_xiv.GalleryView({\n            model:{\n                attributes:{\n                    items:imagesHtml\n                }\n            }\n        } );\n        galleryView.template=_.template(jQuery(\"script#bbg_xiv-template_\"+template+\"_container\").html(),null,bbg_xiv.templateOptions);\n        container.empty();\n        container.append(galleryView.render().$el.find(\"bbg_xiv-container\"));\n    };\n\n    // debugging utilities\n    \n    // dumpFieldNames() dumps field names as <th> elements in a <tr> element\n    var fieldNames=[];\n    bbg_xiv.dumpFieldNames=function(collection){\n        collection.forEach(function(model){\n            Object.keys(model.attributes).forEach(function(key){\n                if(fieldNames.indexOf(key)===-1){\n                    fieldNames.push(key);\n                }\n            });\n        });\n        var buffer=\"<tr>\";\n        fieldNames.forEach(function(name){\n            buffer+=\"<th>\"+name+\"</th>\";\n        });\n        buffer+=\"</tr>\";\n        return buffer;\n    };\n    \n    // dumpFieldValues() dumps field values as <td> elements in <tr> elements\n    bbg_xiv.dumpFieldValues=function(collection){\n        var buffer=\"\";\n        collection.forEach(function(model){\n            buffer+=\"<tr>\";\n            fieldNames.forEach(function(name){\n                buffer+=\"<td>\"+model.attributes[name]+\"</td>\";\n            });\n            buffer+=\"</tr>\";\n        });\n        return buffer;        \n    };\n    \n    bbg_xiv.renderTable=function(container,collection){\n        var galleryView=new bbg_xiv.GalleryView({\n            model:{\n                attributes:{\n                    collection:collection\n                }\n            }\n        } );\n        galleryView.template=_.template(jQuery(\"script#bbg_xiv-template_table_container\").html(),null,bbg_xiv.templateOptions);\n        container.empty();\n        container.append(galleryView.render().$el.find(\"div.bbg_xiv-table\"));\n    };\n    \n    bbg_xiv.constructImages = function( gallery ) {\n        var images;\n        images             = bbg_xiv.images[ gallery.id ];\n        images.id          = gallery.id;\n        images.constructed = true;\n        return images;\n    };\n    \n    bbg_xiv.renderGallery=function(gallery,view,flags){\n        if(!flags){\n            flags=[];\n        }\n        // extract flags from data attribute flags\n        if(gallery.dataset.flags){\n            flags=flags.concat(gallery.dataset.flags.split(\",\"));\n        }\n\n        var jqGallery=jQuery(gallery);\n        var images=bbg_xiv.images[gallery.id];\n        if(!images||!images.constructed){\n            images=bbg_xiv.constructImages(gallery);\n        }\n        // remember the initial statically loaded gallery so we can efficiently return to it\n        bbg_xiv.galleries[gallery.id]=bbg_xiv.galleries[gallery.id]||{images:{\"gallery_home\":images},view:\"gallery_home\"};\n        function constructOverlay() {\n            // gallery or dense view shows a full browser viewport view of an image when its fullscreen glyph is clicked\n            var outer          = jqGallery.find( 'div.bbg_xiv-dense_outer' );\n            var inner          = jqGallery.find( 'div.bbg_xiv-dense_inner' );\n            var $altInner      = jqGallery.find( 'div.bbg_xiv-dense_alt_inner' );\n            var overlayShowing = false;\n            var overlayLocked  = false;\n            var mouseX         = NaN;\n            var mouseY         = NaN;\n            var $caption       = null;\n            function hideOverlay( e ) {\n                if ( ! overlayShowing ) {\n                    // ignore events when overlay is transitioning to hide\n                    return;\n                }\n                if ( e.type !== 'click' ) {\n                    if ( overlayLocked ) {\n                        return;\n                    }\n                    if ( Math.abs( e.screenX - mouseX ) < 10 && Math.abs( e.screenY - mouseY ) < 10 ) {\n                        // ignore a small mouse movement\n                        return;\n                    }\n                } else {\n                    if ( ! overlayLocked ) {\n                        // An unlocked overlay must be the alt overlay.\n                        // When the alt overlay is showing from a hover use the first click in the inner to lock the alt overlay.\n                        overlayLocked = true;\n                        $altInner.addClass( 'bbg_xiv-locked' );\n                        return;\n                    }\n                }\n                // This is either a click event on a locked overlay or a large mouse move event on an unlocked alt overlay\n                var $inner = jQuery( this );\n                if ( $inner.hasClass( 'bbg_xiv-dense_outer' ) ) {\n                    // $inner really is outer so ...\n                    $inner = $altInner;\n                }   \n                overlayShowing = overlayLocked = false;\n                $altInner.removeClass( 'bbg_xiv-locked' );\n                mouseX = mouseY = NaN;\n                // fade out and hide overlay\n                $inner.css(\"opacity\",\"0.0\");\n                outer.css(\"opacity\",\"0.0\");\n                // workaround for a bug? in Chrome where navbar is not visible after an overlay is closed\n                var $navbar = jQuery( 'div.bbg_xiv-gallery nav.bbg_xiv-gallery_navbar' ).css( 'opacity', '0.99' );\n                window.setTimeout(function(){\n                    $inner.hide();\n                    outer.hide();\n                    $navbar.css( 'opacity', '1.0' );\n                }, $inner !== $altInner ? 2000 : 500 );\n                // $caption.css( { display: 'block', opacity: '0.7' } );\n            }   // function hideOverlay( e ) {\n            inner.add( $altInner ).click( hideOverlay );\n            outer.add( $altInner ).mousemove( hideOverlay );\n            // when overlay is showing from hover use a click in the outer to lock the overlay\n            outer.click( function( e ) {\n                if ( !overlayLocked ) {\n                    // The overlay must be the alt overlay.\n                    overlayLocked = true;\n                    $altInner.addClass( 'bbg_xiv-locked' );\n                } else {\n                    hideOverlay.call( this, e );\n                }\n            } );\n            var fullImg     = inner.find( 'img' );\n            var fullTitle   = inner.find( 'h1.bbg_xiv-dense_title' );\n            var fullCaption = inner.find( 'h1.bbg_xiv-dense_caption' );\n            if( typeof bbg_xiv.titleColor === 'undefined' ) {\n                // save the initial values of title color and shadow as these will be changed\n                bbg_xiv.titleColor  = fullTitle.css( 'color' );\n                bbg_xiv.titleShadow = fullTitle.css( 'text-shadow' );\n            }\n            if ( bbg_xiv.guiInterface === 'mouse' ) {\n                // only show title on mouseover\n                fullImg.hover(\n                    function() {\n                        fullTitle.css({   color: bbg_xiv.titleColor, textShadow: bbg_xiv.titleShadow});\n                        fullCaption.css({ color: bbg_xiv.titleColor, textShadow: bbg_xiv.titleShadow});\n                    },\n                    function() {\n                        fullTitle.css({   color: 'transparent', textShadow: 'none' });\n                        fullCaption.css({ color: 'transparent', textShadow: 'none' });\n                    }\n                );\n            }\n            var altOverlayView      = new bbg_xiv.ImageView();\n            altOverlayView.template = _.template( jQuery( 'script#bbg_xiv-template_justified_alt_overlay' ).html(), null, bbg_xiv.templateOptions );\n            function showOverlay( e ) {\n                var $button;\n                if ( this.tagName === 'A' ) {\n                    // click from carousel info button\n                    $button = jQuery( this );\n                } else if ( this.tagName === 'SPAN' ) {\n                    $button = jQuery( this.parentNode );\n                } else {\n                    $button = jQuery( this );\n                }\n                if ( parseFloat( $button.closest( 'div.caption' ).css( 'opacity' ) ) < 0.1 ) {\n                    // click was on an invisible button so ignore it\n                    return;\n                }\n                overlayShowing = true;\n                overlayLocked  = e.type === 'click';\n                mouseX         = e.screenX;\n                mouseY         = e.screenY;\n                $caption       = $button.parent( 'div.caption' );\n                var alt        = $button.hasClass( 'bbg_xiv-carousel_info' ) || $button.hasClass( 'bbg_xiv-dense_alt_btn' );   // use the alternate overlay view\n                if ( alt && overlayLocked ) {\n                    $altInner.addClass( 'bbg_xiv-locked' );\n                }\n                var img;\n                // the buttons are of four different types so the associated image is found differently depending on the type\n                if ( $button.hasClass( 'bbg_xiv-carousel_info' ) ) {\n                    // click from carousel info button\n                    img = $button.closest( 'div.carousel' ).find( 'div.carousel-inner figure.item.active img' )[0];\n                } else if ( $button.hasClass( 'bbg_xiv-dense_from_image' ) ) {\n                    img = $button.parents( 'div.bbg_xiv-dense_flex_item' ).find( 'img' )[0];\n                } else if ( $button.hasClass( 'bbg_xiv-dense_from_title' ) ) {\n                    img = jQuery( 'div#' + this.parentNode.id.replace( 'title', 'image' ) ).find( 'img' )[0];\n                } else if ( $button.hasClass( 'bbg_xiv-flex_from_image' ) ) {\n                    img = $button.parents( 'div.bbg_xiv-flex_item' ).find( 'img' )[0];\n                } else if ( $button.hasClass( 'bbg_xiv-dense_from_justified') ) {\n                    img = $button.parents( 'div.bbg_xiv-justified_item' ).find( 'img' )[0];\n                }\n                var data;\n                try {\n                    var galleryId=jQuery(img).parents(\"div[data-bbg_xiv-gallery-id]\")[0].dataset.bbg_xivGalleryId;\n                    data = bbg_xiv.images[ galleryId ].get( img.dataset.bbg_xivImageId ).attributes;\n                    if ( ! alt ) {\n                        fullImg[0].src=bbg_xiv.getSrc(data,\"viewport\",false);\n                        if(data.bbg_srcset){\n                            fullImg[0].srcset=bbg_xiv.getSrcset(data);\n                        }else{\n                            fullImg[0].removeAttribute(\"sizes\");\n                        }\n                        fullTitle[0].textContent=bbg_xiv.getTitle(data);\n                        fullCaption[0].textContent=bbg_xiv.getCaption(data);\n                    } else {\n                        // instantiate the alternate overlay\n                        altOverlayView.model = { attributes: data };\n                        $altInner.find( 'div.bbg_xiv-dense_alt_items' ).html( altOverlayView.render( true ) );\n                        $altInner.find( 'span.bbg_xiv-item_value a' ).click( function( e ) {\n                            // click on a elements should be ignored if the overlay is not locked, propagation will then lock the overlay as expected\n                            if ( ! jQuery( this ).parents( 'div.bbg_xiv-dense_alt_inner' ).hasClass( 'bbg_xiv-locked' ) ) {\n                                e.preventDefault();\n                            }\n                        } );\n                    }\n                } catch ( error ) {\n                    console.log('##### broken 1');\n                    if ( ! alt ) {\n                        fullImg[0].src = img.src;\n                    }\n                }\n                // show and fade in overlay\n                outer.show();\n                if ( ! alt ) {\n                    // show full image overlay\n                    $altInner.hide();\n                    inner.show();\n                } else {\n                    // show alternate overlay\n                    inner.hide();\n                    $altInner.show();\n                }\n                if ( bbg_xiv.guiInterface === 'touch' ) {\n                    // force hover effects on touchscreen\n                    fullTitle.css({   color: bbg_xiv.titleColor, textShadow: bbg_xiv.titleShadow});\n                    fullCaption.css({ color: bbg_xiv.titleColor, textShadow: bbg_xiv.titleShadow});\n                }\n                window.setTimeout(function(){\n                    ( ! alt ? inner : $altInner ).css( 'opacity', '1.0' );\n                    outer.css(\"opacity\",\"0.93\");\n                },100);\n                $caption.css( { display: 'block', opacity: '0.7' } );\n                e.preventDefault();\n                e.stopPropagation();\n            }  // function showOverlay( e ) {\n            jqGallery.find( 'a.bbg_xiv-carousel_info' ).click( function( e ) {\n                pause( this );\n                // show alt overlay\n                showOverlay.call( this, e );\n            } );\n            jqGallery.find( 'button.bbg_xiv-dense_full_btn, button.bbg_xiv-dense_alt_btn' ).click( showOverlay );\n            jqGallery.find( 'button.bbg_xiv-dense_alt_btn span.glyphicon' ).mouseenter( showOverlay );\n        }   // function constructOverlay() {\n        var titlesButton=jqGallery.parents(\"div.bbg_xiv-gallery\").find(\"nav.navbar button.bbg_xiv-titles\").hide();\n        switch(view){\n        case \"Gallery\":\n            if(flags.indexOf(\"tiles\")!==-1){\n                bbg_xiv.renderTiles(jqGallery,images,flags);\n                constructOverlay();\n                titlesButton.show();\n// TODO: renderFlex commented out to force renderBootstrapGallery for testing JSX code - uncomment!\n/*\n            } else if ( Modernizr.flexbox && Modernizr.flexwrap && ! window.bbg_xiv.bbg_xiv_disable_flexbox ) {\n                bbg_xiv.renderFlex(jqGallery,images);\n                constructOverlay();\n*/ \n            }else{\n                bbg_xiv.renderBootstrapGallery(jqGallery,images);\n            }\n            window.setTimeout(function(){\n                jQuery(window).resize();\n            },100);\n            break;\n        case \"Justified\":\n            bbg_xiv.renderJustified(jqGallery,images);\n            constructOverlay();\n            titlesButton.show();\n            break;\n        case \"Carousel\":\n            if(flags.indexOf(\"embedded-carousel\")!==-1){\n                jqGallery.addClass(\"bbg_xiv-embedded_carousel\");\n            }else{\n                jQuery(\"html\").css(\"overflow-y\",\"hidden\");\n            }\n            var carouselId=\"bbg_xiv-carousel_\"+gallery.id;\n            bbg_xiv.renderCarousel(jqGallery,images,carouselId);\n            constructOverlay();\n            // pause() can be called from a button's event handler to pause the carousel, the argument is the button\n            function pause( button ) {\n                var $carousel = jQuery( button ).parents( 'div.carousel' );\n                $carousel.carousel( 'pause' );\n                $carousel.find( 'a.bbg_xiv-carousel_play span.glyphicon' ).removeClass( 'glyphicon-pause' ).addClass( 'glyphicon-play' ).parent().attr( 'title', bbg_xiv_lang['Play'] );\n            }\n            // Wireup the handlers - this must be done here as the elements in the carousel view are dynamically created\n            // Carousel pause handler\n            jqGallery.find( 'a.bbg_xiv-carousel_play' ).click( function( e ) {\n                var $this     = jQuery( this );\n                var $carousel = $this.parents( 'div.carousel' );\n                var $span     = $this.find( 'span.glyphicon' );\n                if ( $span.hasClass( 'glyphicon-pause' ) ) {\n                    pause( this );\n                } else {\n                    $span.removeClass( 'glyphicon-play' ).addClass( 'glyphicon-pause' ).parent().attr( 'title', bbg_xiv_lang['Pause'] );\n                    $carousel.carousel( 'next' );\n                    $carousel.carousel( 'cycle' );\n                }\n                e.preventDefault();      \n            });\n            jqGallery.find( 'a.bbg_xiv-carousel_left, a.bbg_xiv-carousel_right' ).click(function() {\n                pause(this);\n            });\n            // Carousel rewind handler\n            jqGallery.find(\"a.bbg_xiv-carousel_first span.glyphicon,a.bbg_xiv-carousel_last span.glyphicon\").click(function(e){\n                pause( this );\n                var carousel=jQuery(this).parents(\"div.carousel\");\n                if(jQuery(this.parentNode).hasClass(\"bbg_xiv-carousel_first\")){\n                    carousel.carousel(0);\n                }else{\n                    carousel.carousel(images.length-1);\n                }\n                e.preventDefault();      \n            });\n            jqGallery.find( 'a.bbg_xiv-carousel_help span.glyphicon' ).click( function( e ) {\n                window.open( bbg_xiv.docUrl + '#view-carousel', '_blank' );\n                e.preventDefault();      \n            } );\n            jqGallery.find(\"a.bbg_xiv-carousel_close\").click(function(e){\n                // restore \"Gallery View\"\n                jqGallery.removeClass(\"bbg_xiv-embedded_carousel\");\n                bbg_xiv.resetGallery(jQuery(this).parents(\"div.bbg_xiv-gallery\"),\"Carousel\");\n                jQuery( 'html' ).css( 'overflow-y', '' );\n                e.preventDefault();      \n            });\n            var input=jqGallery.find(\"div.bbg_xiv-jquery_mobile input[type='range']\");\n            input.slider();\n            var prevChangeTime;\n            var slideChange=false;   // change event triggered by a carousel slid event\n            // update Bootstrap carousel slide when jQuery mobile slider changes\n            // jQuery Mobile should change the \"type\" from \"range\" to \"number\" but does not so force it.\n            // TODO: Find out why jQuery Mobile is not doing this here - maybe I am doing something wrong.\n            input.attr( 'type', 'number' ).val( '1' ).change(function() {\n                if(slideChange){\n                    // ignore change events triggered by a carousel slid event\n                    return;\n                }\n                prevChangeTime=Date.now();\n                var carousel=jQuery(this).parents(\"div.carousel\");\n                pause(input);\n                // Since change events will occur much too rapidly wait until they quiesce\n                window.setTimeout(function(){\n                    if(Date.now()-prevChangeTime>=500){\n                        var i=input.val();\n                        if(jQuery.isNumeric(i)){\n                            i = parseInt( i, 10 ) - 1;\n                            if(i>=0&&i<images.length){\n                                carousel.carousel(i);\n                                pause(input);\n                            }\n                        }\n                    }\n                },500);\n            }).keypress(function(e){\n                if(e.which===13){\n                    jQuery(this).blur();\n                    e.preventDefault();\n                }\n            }).focus(function() {\n                pause(this);\n            }).on( 'slidestart', function() {\n                pause(this);\n            });\n            // update jQuery Mobile slider when Bootstrap carousel changes slide\n            jqGallery.find(\"div.carousel\").on(\"slide.bs.carousel slid.bs.carousel\",function(e){\n                slideChange=true;\n                // update input element and trigger change event to force update of slider position\n                jQuery( this ).find( 'div.bbg_xiv-jquery_mobile input[type=\"number\"]' ).val( parseInt( e.relatedTarget.dataset.index, 10 ) + 1 ).change();\n                slideChange=false;\n            });\n            if ( flags.indexOf( 'embedded-carousel' ) !== -1 ) {\n                window.setTimeout( function() {\n                    // the timeout is necessary to give browser time to render the image before the scrolling is done\n                    var $gallery     = jqGallery.closest( 'div.bbg_xiv-gallery' );\n                    var $divCarousel = jqGallery.find( 'div.carousel' );\n                    if ( $gallery.hasClass( 'bbg_xiv-fullscreen_gallery' ) ) {\n                        // full screen\n                        if ( window.matchMedia( '(max-aspect-ratio:1/1)' ).matches ) {\n                            // portrait mode\n                        } else {\n                            // landscape mode\n                            $gallery.scrollTop( $gallery[0].scrollHeight - $gallery.height() - 50 + 0.05 * $divCarousel.height() );\n                        }\n                    } else {\n                        // not full screen\n                        if(window.matchMedia(\"(max-aspect-ratio:1/1)\").matches){\n                            // portrait mode\n                            jQuery(window).scrollTop( $divCarousel.offset().top - jQuery(window).height()/6 );\n                        }else{\n                            // landscape mode\n                            // If WordPress admin bar is showing on frontend page adjust for it.\n                            var $body            = jQuery( 'body' );\n                            var $adminBar        = jQuery( 'div#wpadminbar' );\n                            var adminBarHeight   = $body.hasClass( 'admin-bar' ) && $adminBar.css( 'position' ) == 'fixed' ? $adminBar.outerHeight() : 0;\n                            var bodyBeforeHeight = 0;\n                            if ( $body.hasClass( 'bbg_xiv-twentysixteen_with_border' ) ) {\n                                // Adjust for the black border in the WordPress TwentySixteen theme.\n                                var bodyBeforeStyle = window.getComputedStyle( $body[0], ':before' );\n                                bodyBeforeHeight    = bodyBeforeStyle && bodyBeforeStyle.position === 'fixed' ? parseInt( bodyBeforeStyle.height, 10 ) : 0;\n                            }\n                            jQuery( window ).scrollTop( $divCarousel.offset().top - $divCarousel.outerHeight() / 18 - adminBarHeight - bodyBeforeHeight );\n                        }\n                    }\n                }, 500 );\n            }\n            jQuery(\"#\"+carouselId).carousel({interval:bbg_xiv.bbg_xiv_carousel_interval,pause:false});\n            break;\n        case \"Tabs\":\n            bbg_xiv.renderTabs(jqGallery,images,\"bbg_xiv-tabs_\"+gallery.id);\n            bbg_xiv.prettifyTabs(jqGallery,true);\n            jqGallery.find( 'nav.navbar ul.nav li a' ).click(function() {\n                if(!Modernizr.objectfit){\n                    // Microsoft Edge does not support CSS object-fit so do the object fit with JavaScript code\n                    jQuery(this.href.substr(this.href.lastIndexOf(\"#\"))+\" img\").each(function(){\n                        var img=this;\n                        var i=0;\n                        var j=0;\n                        var r0;\n                        window.setTimeout(function f(){\n                            var w=img.naturalWidth;\n                            var h=img.naturalHeight;\n                            var parent=jQuery(img.parentNode.parentNode.parentNode);\n                            var W=parent.width();\n                            var H=0.7*jQuery(window).height();\n                            if(!w||!h||!W||!H||W<64||H<64){\n                                if(i++<16){\n                                    window.setTimeout(f,250);\n                                }\n                                return;\n                            }\n                            var r=Math.max(w/W,h/H);\n                            if(r<0.125||r>8){\n                                return;\n                            }\n                            if(typeof r0!=='undefined'&&r===r0){\n                                return;\n                            }\n                            w=Math.floor(w/r);\n                            h=Math.floor(h/r);\n                            jQuery(img).css({width:w+\"px\",height:h+\"px\"});\n                            r0=r;\n                            if(j++<16){\n                                window.setTimeout(f,250);\n                            }\n                        },250);\n                    });\n                }\n                window.setTimeout(function() {\n                    // the timeout is necessary to give browser time to render the image before the scrolling is done\n                    var $window    = jQuery( window );\n                    var $gallery   = jqGallery.closest( 'div.bbg_xiv-gallery' );\n                    var fullscreen = $gallery.hasClass( 'bbg_xiv-fullscreen_gallery' );\n                    var $content   = jqGallery.find( 'div.tab-content' );\n                    if( window.matchMedia( '(max-aspect-ratio:1/1)' ).matches ) {\n                        // portrait mode\n                        if ( fullscreen ) {\n                            $gallery.scrollTop( $gallery.scrollTop() + $content.position().top  - $window.height() / 3 - 20 );\n                        } else {\n                            $window.scrollTop( $content.offset().top - $window.height() / 3 - 20 );\n                        }\n                    } else {\n                        // landscape mode\n                        if ( fullscreen ) {\n                            $gallery.scrollTop( $gallery.scrollTop() + $content.position().top - 90 );\n                        } else {\n                            var $body            = jQuery( 'body' );\n                            var $adminBar        = jQuery( 'div#wpadminbar' );\n                            // If WordPress admin bar is showing on frontend page adjust for it.\n                            var adminBarHeight   = $body.hasClass( 'admin-bar' ) && $adminBar.css( 'position' ) == 'fixed' ? $adminBar.outerHeight() : 0;\n                            var bodyBeforeHeight = 0;\n                            if ( $body.hasClass( 'bbg_xiv-twentysixteen_with_border' ) ) {\n                                // Adjust for the black border in the WordPress TwentySixteen theme.\n                                var bodyBeforeStyle = window.getComputedStyle( $body[0], ':before' );\n                                bodyBeforeHeight    = bodyBeforeStyle && bodyBeforeStyle.position === 'fixed' ? parseInt( bodyBeforeStyle.height, 10 ) : 0;\n                            }\n                            var offset              = $window.height() >= 480 ? 80 : 40;\n                            $window.scrollTop( $content.offset().top - offset - adminBarHeight - bodyBeforeHeight );\n                        }\n                    }\n                }, 500 );\n            });\n            // intercept clicks when images belong to gallery of galleries\n            if(jqGallery.hasClass(\"bbg_xiv-gallery_icons_mode\")){\n                jqGallery.find(\"div.bbg_xiv-template_tabs_container div.tab-content figure.tab-pane a\").click(function(e){\n                    var galleries=jqGallery.parent().find(\"nav.bbg_xiv-gallery_navbar ul.nav li.dropdown ul.bbg_xiv-view_menu li.bbg_xiv-alt_gallery\");\n                    // only intercept clicks on the home gallery\n                    if(galleries.filter(\".bbg_xiv-alt_gallery_home\").hasClass(\"active\")){\n                        galleries.find(\"a[data-view='gallery_\"+this.dataset.galleryIndex+\"']\").click();\n                        e.preventDefault();\n                    }\n                });\n            }\n            // make the \"Tabs\" brand clickable for mobile devices and send click to the toggle button\n            jqGallery.find(\"a.bbg_xiv-tabs_brand\").click(function(e){\n                var toggle=jQuery(this).siblings(\"button.navbar-toggle\");\n                if(toggle.css(\"display\")!==\"none\"){\n                    toggle.click();\n                }\n                e.preventDefault();\n            });\n            if ( bbg_xiv.guiInterface === 'touch' ) {\n                // For mobile devices if a scrollbar is needed then initially expand the tab navbar as the collapsed tab navbar is not user friendly on mobile devices\n                jQuery( 'div.bbg_xiv-gallery nav.bbg_xiv-gallery_navbar' ).find( 'span.glyphicon-collapse-down' ).each(function(){\n                    var jqThis=jQuery(this);\n                    if(jqThis.css(\"display\")!==\"none\"){\n                        jqThis.click();\n                    }\n                });\n            }\n            break;\n        case \"Dense\":\n            jQuery(\"html\").css(\"overflow-y\",\"hidden\");\n            bbg_xiv.renderDense(jqGallery,images,\"bbg_xiv-dense_\"+gallery.id,\"title\");\n            jqGallery.find(\"div.bbg_xiv-dense_images div.bbg_xiv-dense_flex_images div.bbg_xiv-dense_flex_item\")\n                .css(\"width\",100/bbg_xiv.bbg_xiv_flex_number_of_dense_view_columns+\"%\");\n            var normal=jQuery(\"div.bbg_xiv-dense_container button#bbg_xiv-normal_color\").css(\"background-color\");\n            var highlight=jQuery(\"div.bbg_xiv-dense_container button#bbg_xiv-highlight_color\").css(\"background-color\");\n            jqGallery.find(\"div.bbg_xiv-dense_titles ul li\").hover(\n                function() {\n                    // highlight matching image\n                    jQuery(this).css({\"background-color\":highlight});\n                    var img=jQuery(\"div#\"+this.id.replace(\"title\",\"image\")).css({\"border-color\":highlight});\n                    // scroll images view if matching image is hidden\n                    var top=img.position().top;\n                    var height=img.height();\n                    var bottom=top+height;\n                    var div = img.parents( 'div.bbg_xiv-dense_images' );\n                    var scrollTop=div.scrollTop();\n                    var scrollHeight=div.height();\n                    if(top<0){\n                        div.scrollTop(scrollTop+top-scrollHeight/2-height/2);\n                    }else if(bottom>scrollHeight){\n                        div.scrollTop(scrollTop+(bottom-scrollHeight)+scrollHeight/2-height/2);\n                    }\n                },\n                function() {\n                    jQuery(this).css({\"background-color\":normal});\n                    jQuery(\"div#\"+this.id.replace(\"title\",\"image\")).css({\"border-color\":normal});\n                }\n            );\n            jqGallery.find(\"div.bbg_xiv-dense_flex_item\").hover(\n                function() {\n                    jQuery(this).css({\"border-color\":highlight});\n                    // highlight matching title\n                    var li=jQuery(\"li#\"+this.id.replace(\"image\",\"title\")).css({\"background-color\":highlight});\n                    // scroll titles view if matching title is hidden\n                    var top=li.position().top;\n                    var height=li.height();\n                    var bottom=top+height;\n                    var div = li.parents( 'div.bbg_xiv-dense_titles' );\n                    var scrollTop=div.scrollTop();\n                    var scrollHeight=div.height();\n                    if(top<0){\n                        div.scrollTop(scrollTop+top-scrollHeight/2-height/2);\n                    }else if(bottom>scrollHeight){\n                        div.scrollTop(scrollTop+(bottom-scrollHeight)+scrollHeight/2-height/2);\n                    }\n                },\n                function() {\n                    jQuery(this).css({\"border-color\":normal});\n                    jQuery(\"li#\"+this.id.replace(\"image\",\"title\")).css({\"background-color\":normal});\n                }\n            );\n            jqGallery.find( 'input.bbg_xiv-dense_li_mode' ).change(function() {\n                // show titles or captions depending on the radio buttons \n                if(this.checked){\n                    var div=jQuery(\"div.bbg_xiv-dense_container div.bbg_xiv-dense_titles\");\n                    if(this.value===\"title\"){\n                        div.find(\"span.bbg_xiv-dense_li_caption\").hide();\n                        div.find(\"span.bbg_xiv-dense_li_title\").show();\n                        div.find(\"span.bbg_xiv-dense_li_alt\").hide();\n                    }else if(this.value===\"caption\"){\n                        div.find(\"span.bbg_xiv-dense_li_title\").hide();\n                        div.find(\"span.bbg_xiv-dense_li_caption\").show();\n                        div.find(\"span.bbg_xiv-dense_li_alt\").hide();\n                    }else if(this.value===\"alt\"){\n                        div.find(\"span.bbg_xiv-dense_li_title\").hide();\n                        div.find(\"span.bbg_xiv-dense_li_caption\").hide();\n                        div.find(\"span.bbg_xiv-dense_li_alt\").show();\n                    }\n                }\n            });\n            jqGallery.find( 'button.bbg_xiv-dense_info_btn' ).click( function( e ) {\n                window.open( bbg_xiv.docUrl + '#view-dense', '_blank' );\n                e.preventDefault();      \n            } );\n            jqGallery.find(\"button.bbg_xiv-dense_close_btn\").click(function(e){\n                // restore \"Gallery View\"\n                bbg_xiv.resetGallery(jQuery(this).parents(\"div.bbg_xiv-gallery\"));\n                jQuery( 'html' ).css( 'overflow-y', '' );\n                e.preventDefault();      \n            });\n            constructOverlay();\n            break;\n        // TODO: Add entry for new views here\n        case \"Table\":\n            bbg_xiv.renderTable(jqGallery,images);\n            break;\n        default:\n            break;\n        }\n        var menuItems=jQuery(gallery.parentNode).find(\"nav.bbg_xiv-gallery_navbar ul.nav ul.bbg_xiv-view_menu li\").show();\n        if ( bbg_xiv.guiInterface !== 'mouse' || jQuery( window ).width() < bbg_xiv.bbg_xiv_flex_min_width_for_dense_view ) {\n            // for touch and small screen devices hide the dense menu item\n            menuItems.filter( '.bbg_xiv-large_viewport_only' ).hide();\n        }\n        if(bbg_xiv.search[gallery.id]){\n            // displaying search results so hide gallery headings\n            jQuery(\"div#\"+gallery.id+\"-alt_gallery_heading\").hide();\n            // and show search results heading\n            jQuery(\"div#\"+gallery.id+\"-heading\").show();\n        }else if(bbg_xiv.galleries[gallery.id]){\n            // displaying a gallery so hide search results heading\n            jQuery(\"div#\"+gallery.id+\"-heading\").hide();\n            var galleryOfGalleries=typeof bbg_xiv.images[gallery.id].models[0].attributes.gallery_index!==\"undefined\";\n            var divAltGalleryHeading=jQuery(\"div#\"+gallery.id+\"-alt_gallery_heading\");\n            if(galleryOfGalleries){\n                // show heads up for gallery of galleries\n                divAltGalleryHeading.find(\"span.bbg_xiv-alt_gallery_heading\").text(bbg_xiv.galleryOfGalleriesTitle);\n                // click handler for gallery icon images\n                jqGallery.find(\"a.bbg_xiv-gallery_icon\").click(function(e){\n                    jqGallery.parent().find( 'nav.bbg_xiv-gallery_navbar ul.nav li.dropdown ul.bbg_xiv-view_menu li.bbg_xiv-alt_gallery > a[data-view=\"gallery_' +\n                        this.dataset.galleryIndex+'\"]').click();\n                    e.preventDefault();\n                });\n                // hide inappropriate menu items for gallery of galleries\n                menuItems.filter(\".bbg_xiv-hide_for_gallery_icons\").hide();\n            }\n            if(bbg_xiv.galleries[gallery.id].view!==\"gallery_home\"||galleryOfGalleries){\n                // and show title of alternate galleries or heads up for gallery of galleries; except hide title for home gallery; \n                divAltGalleryHeading.show();\n            }\n        }\n    };\n    \n    // tabs are used twice - to show a list of gallery titles and a list of image titles. prettifyTabs() implements the common functionality for both\n    bbg_xiv.prettifyTabs=function(jqGallery,initial){\n        // Adjust the tab view according to its environment\n        var navbar=jqGallery.find(\"nav.navbar\");\n        // In portrait mode show the tabs navbar uncollapsed\n        var toggle=navbar.find(\"button.navbar-toggle\");\n        if(toggle.css(\"display\")!==\"none\"){\n            toggle.click();\n        }\n        // Hide the expand glyph and scrollbar if not needed.\n        navbar.find(\"div.navbar-collapse ul.nav\").each(function(){\n            if(jQuery(this).height()-8<=jQuery(this.parentNode).height()){\n                jQuery(this).parents(\"nav.navbar\").find(\"span.glyphicon\").hide();\n                jQuery(this.parentNode).addClass(\"bbg_xiv-hide_scroll\");\n            }\n        });\n        if(initial){\n            // Wireup the handlers - this must be done here as the elements in the tab view are dynamically created\n            // Clicking the expand glpyh shows all the tabs.\n            jqGallery.find( 'span.glyphicon-collapse-down, span.glyphicon-collapse-up' ).click(function() {\n                var jqThis=jQuery(this);\n                var navbar=jQuery(this.parentNode).find(\"div.navbar-collapse\");\n                if(jqThis.hasClass(\"glyphicon-collapse-down\")){\n                    jqThis.removeClass(\"glyphicon-collapse-down\").addClass(\"glyphicon-collapse-up\");\n                    navbar.removeClass(\"bbg_xiv-closed\").addClass(\"bbg_xiv-open\");\n                }else{\n                    jqThis.removeClass(\"glyphicon-collapse-up\").addClass(\"glyphicon-collapse-down\");\n                    navbar.removeClass(\"bbg_xiv-open\").addClass(\"bbg_xiv-closed\");\n                }\n            });\n        }\n    };\n\n    bbg_xiv.resetGallery=function(gallery,currentView){\n        // restore \"Gallery View\"\n        var divGallery=gallery.find(\"div.bbg_xiv-gallery_envelope\")[0];\n        var galleryOfGalleries=typeof bbg_xiv.images[divGallery.id].models[0].attributes.gallery_index!==\"undefined\";\n        var defaultView=bbg_xiv.getDefaultView(jQuery(divGallery),galleryOfGalleries);\n        if(currentView===\"Carousel\"&&defaultView===\"Carousel\"){\n            defaultView=\"Gallery\";\n        }\n        bbg_xiv.renderGallery(divGallery,defaultView);\n        var liSelectView=gallery.find(\"nav.bbg_xiv-gallery_navbar ul.nav li.bbg_xiv-select_view\");\n        var liFirst=liSelectView.find(\"ul.bbg_xiv-view_menu li.bbg_xiv-view\").removeClass(\"active\").filter(\".bbg_xiv-view_\"+defaultView.toLowerCase()).addClass(\"active\");\n        liSelectView.find(\"a.bbg_xiv-selected_view span\").text(liFirst.text());\n        jQuery(window).resize();\n    };\n     \n    // getting attributes indirectly through functions will make it possible for one template to be used for both the REST mode and the old proprietary mode\n\n    // the fullSize parameter is the size of the non-iconic view of the image and should either \"viewport\" or \"container\"\n    // the icon parameter is a boolean indicating that the src is for a thumbnail\n\n    // getSrc() sets the src attribute of <img> HTML elements which will be ignored on modern browsers that support the srcset attribute\n    // i.e. the source selection logic of getSrc() will only be used on older browsers\n\n    bbg_xiv.getSrc = function( data, fullSize,icon ) {\n        switch ( bbg_xiv.bandwidth ) {\n        case \"normal\":\n            return data.source_url;\n        case \"low\":\n            if(icon){\n                return data.bbg_thumbnail_src[0];\n            }else{\n                if(fullSize===\"viewport\"){\n                    return data.bbg_large_src[0];\n                }else{\n                    return data.bbg_medium_large_src[0];\n                }\n            }\n            break;\n        case \"very low\":\n            if(icon){\n                return data.bbg_thumbnail_src[0];\n            }else{\n                if(fullSize===\"viewport\"){\n                    return data.bbg_medium_large_src[0];\n                }else{\n                    return data.bbg_medium_src[0];\n                }\n            }\n        }\n    };\n\n    bbg_xiv.getSrcset=function(data){\n        if(bbg_xiv.bbg_xiv_bandwidth!=='auto'){\n            // really should removeAttribute but this should work\n            return \"\";\n        }\n        return data.bbg_srcset;\n    };\n\n    bbg_xiv.getTitle=function(data){\n        return data.title.rendered.trim();\n    };\n\n    bbg_xiv.getCaption = function( data, noAlt ) {\n        var caption = jQuery(data.caption.rendered).text();\n        if ( ! caption && ! noAlt ) {\n            caption = bbg_xiv.getAlt( data, true );\n        }\n        return caption.trim();\n    };\n\n    bbg_xiv.getAlt = function( data, noCaption ) {\n        var alt = data.alt_text;\n        if (! alt && ! noCaption ) {\n            alt = bbg_xiv.getCaption( data, true );\n        }\n        return alt.trim();\n    };\n\n    bbg_xiv.getPostContent = function( data ) {\n        var postContent = data.bbg_post_content;\n        if( postContent ) {\n            return postContent;\n        }\n        return bbg_xiv.getCaption( data );\n    };\n    \n    bbg_xiv.getSizes=function(data,fullSize,icon){\n        if(bbg_xiv.bbg_xiv_bandwidth!=='auto'){\n            // really should removeAttribute but this should work\n            return \"\";\n        }\n        if(!data){\n            if(fullSize===\"viewport\"&&!icon){\n                return \"100vw\";\n            }\n            return \"50vw\";\n        }         \n        if(!data.bbg_srcset){\n            // really should removeAttribute but this should work\n            return \"\";\n        } else if ( icon ) {\n            return '10vw';\n        }else if(fullSize===\"viewport\"){\n            return \"90vw\";\n        }else if(fullSize===\"container\"){\n            return data.bbg_xiv_container_width+\"px\";\n        }else{\n            return \"50vw\";\n        }\n    };\n\n    try{\n        window.localStorage.setItem(\"test\",\"test\");\n        window.localStorage.removeItem(\"test\");\n        bbg_xiv.localStorageAvailable=true;\n    }catch(e){\n        bbg_xiv.localStorageAvailable=false;\n    }\n    \n    bbg_xiv.setCookie=function(name,value,expires){\n        if(bbg_xiv.localStorageAvailable){\n            localStorage.setItem(name,value);\n        }else{\n            var d=new Date();\n            d.setTime(d.getTime()+(expires*24*60*60*1000));\n            document.cookie=name+\"=\"+value+\"; expires=\"+d.toUTCString()+\"; path=/\";\n        }\n    };\n\n    bbg_xiv.getCookie=function(name){\n        if(bbg_xiv.localStorageAvailable){\n            return localStorage.getItem(name);\n        }else{\n            var cookie=document.cookie;\n            cookie += \";\";\n            var start=cookie.indexOf(name+\"=\");\n            if(start===-1){\n                return null;\n            }\n            start+=name.length+1;\n            var end=cookie.indexOf(\";\",start);\n            if(end===-1){\n                return null;\n            }\n            return cookie.substring(start,end);\n        }\n    };\n\n    bbg_xiv.calcBreakpoints=function(){\n        var minFlexWidth=window.bbg_xiv.bbg_xiv_flex_min_width;\n        bbg_xiv.breakpoints=[\n            {width:2*minFlexWidth,cssClass:\"100\"},\n            {width:3*minFlexWidth,cssClass:\"50\"},\n            {width:4*minFlexWidth,cssClass:\"33_3333\"},\n            {width:5*minFlexWidth,cssClass:\"25\"},\n            {width:6*minFlexWidth,cssClass:\"20\"},\n            {width:7*minFlexWidth,cssClass:\"16_6666\"},\n            {width:8*minFlexWidth,cssClass:\"14_2857\"},\n            {width:9*minFlexWidth,cssClass:\"12_5\"},\n            {width:10*minFlexWidth,cssClass:\"11_1111\"},\n            {width:11*minFlexWidth,cssClass:\"10\"},\n            {width:12*minFlexWidth,cssClass:\"9_0909\"},\n            { width: 1000000, cssClass: '8_3333' }\n        ];\n    };\n\n    bbg_xiv.getOptionsFromCookie=function(){\n        // override options with cookie values if they exists\n        var cookie=bbg_xiv.getCookie(\"bbg_xiv\");\n        if(cookie){\n            var options=JSON.parse(cookie);\n            var carousel_interval=options.bbg_xiv_carousel_interval;\n            if(jQuery.isNumeric(carousel_interval)&&carousel_interval>=1000){\n                bbg_xiv.bbg_xiv_carousel_interval=carousel_interval;\n            }\n            var flex_min_width=options.bbg_xiv_flex_min_width;\n            if(jQuery.isNumeric(flex_min_width)&&flex_min_width>=32&&flex_min_width<=1024){\n                bbg_xiv.bbg_xiv_flex_min_width=flex_min_width;\n            }\n            var miro_row_height = options.bbg_xiv_miro_row_height;\n            if ( jQuery.isNumeric( miro_row_height ) && miro_row_height >= 32 && miro_row_height <= 512 ) {\n                bbg_xiv.bbg_xiv_miro_row_height = miro_row_height;\n            }\n            var max_search_results=options.bbg_xiv_max_search_results;\n            if(jQuery.isNumeric(max_search_results)&&max_search_results>=1&&max_search_results<1048576){\n                bbg_xiv.bbg_xiv_max_search_results=max_search_results;\n            }\n            var flex_number_of_dense_view_columns=options.bbg_xiv_flex_number_of_dense_view_columns;\n            if(jQuery.isNumeric(flex_number_of_dense_view_columns)&&flex_number_of_dense_view_columns>=2&&flex_number_of_dense_view_columns<=32){\n                bbg_xiv.bbg_xiv_flex_number_of_dense_view_columns=flex_number_of_dense_view_columns;\n            }\n            if(typeof options.bbg_xiv_default_view===\"string\"){\n                bbg_xiv.bbg_xiv_default_view=options.bbg_xiv_default_view;\n                bbg_xiv.usingServerDefaultView=false;\n            }else{\n                bbg_xiv.usingServerDefaultView=true;\n            }\n            if(typeof options.bbg_xiv_bandwidth===\"string\"){\n                bbg_xiv.bbg_xiv_bandwidth=options.bbg_xiv_bandwidth;\n            }\n            if(typeof options.bbg_xiv_interface===\"string\"){\n                bbg_xiv.bbg_xiv_interface=options.bbg_xiv_interface;\n            }\n        }else{\n            bbg_xiv.usingServerDefaultView=true;\n            bbg_xiv.bbg_xiv_bandwidth=\"auto\";\n            bbg_xiv.bbg_xiv_interface=\"auto\";\n        }\n        var userAgent=navigator.userAgent;\n        if(userAgent.indexOf(\"Firefox\")!==-1){\n            bbg_xiv.browser=\"Firefox\";\n        }else{\n            bbg_xiv.browser=\"\";\n        }\n        // compute bandwidth if bandwidth is set to auto - currently since this is not done reliably the user should set the bandwidth option manually\n        if(bbg_xiv.bbg_xiv_bandwidth===\"auto\"){\n            if(Modernizr.lowbandwidth){\n                // this uses navigator.connection which is only supported by Android\n                bbg_xiv.bandwidth=\"very low\";\n            }else if(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(userAgent)){\n                // determining bandwidth by device type is not reliable!\n                bbg_xiv.bandwidth=\"very low\";\n            }else{\n                bbg_xiv.bandwidth=\"low\";\n            }\n        }else{\n            bbg_xiv.bandwidth=bbg_xiv.bbg_xiv_bandwidth;\n        }\n        // compute interface if interface is auto\n        if(bbg_xiv.bbg_xiv_interface===\"auto\"){\n            if(Modernizr.touchevents){\n                bbg_xiv.guiInterface = 'touch';\n            }else{\n                bbg_xiv.guiInterface = 'mouse';\n            }\n        }else{\n            bbg_xiv.guiInterface = bbg_xiv.bbg_xiv_interface;\n        }\n        // WP REST API requires that per_page be between 1 and 100 inclusive\n        bbg_xiv.wpRestApiMaxPerPage=100;\n    };\n    \n    bbg_xiv.getOptionsFromCookie();\n    bbg_xiv.calcBreakpoints();\n    \n    jQuery(window).resize(function(){\n        var breakpoints=bbg_xiv.breakpoints;\n        jQuery(\"div.bbg_xiv-flex_container,div.bbg_xiv-gallery_container\").each(function(){\n            var jqThis=jQuery(this);\n            var width=jqThis.width();\n            var pxWidth;\n            var minFlexWidthForCaption=window.bbg_xiv.bbg_xiv_flex_min_width_for_caption;\n            if(jqThis.parents(\"div.bbg_xiv-gallery_envelope\").hasClass(\"bbg_xiv-tiles_container\")){\n                // set tile width and height in pixels so that tiles cover the div exactly and completely\n                pxWidth = Math.floor( width / Math.floor( width / window.bbg_xiv.bbg_xiv_flex_min_width ) ) - 1;\n                jqThis.find(\"div.bbg_xiv-flex_item\").css({width:pxWidth,height:pxWidth});\n                if(pxWidth<minFlexWidthForCaption){\n                    jqThis.find(\"div.bbg_xiv-flex_item figcaption\").hide();\n                }\n            }else{\n                // find the smallest percentage width that satisfies the minimum image width\n                breakpoints.forEach(function(breakpoint){\n                  jqThis.removeClass(\"bbg_xiv-flex_width_\"+breakpoint.cssClass);\n                });\n                for(var i=0;i<breakpoints.length;i++){\n                    if(width<breakpoints[i].width){\n                        var cssClass=breakpoints[i].cssClass;\n                        jqThis.addClass(\"bbg_xiv-flex_width_\"+cssClass);\n                        pxWidth = parseFloat( cssClass.replace( '_', '.' ) ) / 100.0 * width;\n                        if(pxWidth<minFlexWidthForCaption){\n                            jqThis.addClass(\"bbg_xiv-flex_no_caption\");\n                        }else{\n                            jqThis.removeClass(\"bbg_xiv-flex_no_caption\");\n                        }\n                        break;\n                    }\n                }\n            }\n        });\n        if ( bbg_xiv.guiInterface === 'mouse' && jQuery( window ).width() >= bbg_xiv.bbg_xiv_flex_min_width_for_dense_view ) {\n            jQuery(\".bbg_xiv-configure_inner .bbg_xiv-mouse_only_option\").show();\n        }else{\n            jQuery(\".bbg_xiv-configure_inner .bbg_xiv-mouse_only_option\").hide();\n        }  \n        jQuery(\"div.bbg_xiv-gallery_envelope\").each(function(){\n            var menuItems=jQuery(this.parentNode).find(\"nav.bbg_xiv-gallery_navbar ul.nav ul.bbg_xiv-view_menu li\").show();\n            if ( bbg_xiv.guiInterface !== 'mouse' || jQuery( window ).width() < bbg_xiv.bbg_xiv_flex_min_width_for_dense_view ) {\n                // for touch and small screen devices hide the dense menu item\n                menuItems.filter(\".bbg_xiv-large_viewport_only\").hide();\n            }\n            if(typeof bbg_xiv.images[this.id].models[0].attributes.gallery_index!==\"undefined\"){\n                // for a gallery of gallery icons hide the carousel and the dense menu items\n                menuItems.filter(\".bbg_xiv-hide_for_gallery_icons\").hide();\n            }\n        });\n    });\n\n    bbg_xiv.getDefaultView=function(gallery,galleryOfGalleries){\n        var defaultView;\n        if(galleryOfGalleries||(galleryOfGalleries===null&&gallery.hasClass(\"bbg_xiv-gallery_icons_mode\"))){\n            // for gallery of galleries always use the gallery view\n            defaultView = 'Gallery';\n        }else{\n            // use class to set default view if it exists otherwise use the global value\n            defaultView = bbg_xiv.bbg_xiv_default_view ? bbg_xiv.bbg_xiv_default_view : 'Gallery';\n            if(bbg_xiv.usingServerDefaultView){\n                if(gallery.hasClass(\"bbg_xiv-default_view_gallery\")){\n                    defaultView=\"Gallery\";\n                }else if(gallery.hasClass(\"bbg_xiv-default_view_justified\")){\n                    defaultView=\"Justified\";\n                }else if(gallery.hasClass(\"bbg_xiv-default_view_carousel\")){\n                    defaultView=\"Carousel\";\n                }else if(gallery.hasClass(\"bbg_xiv-default_view_tabs\")){\n                    defaultView=\"Tabs\";\n                }\n            }\n            gallery.parents(\"div.bbg_xiv-bootstrap.bbg_xiv-gallery\").find(\"nav.bbg_xiv-gallery_navbar ul.nav li.bbg_xiv-select_view ul.bbg_xiv-view_menu li.bbg_xiv-view\")\n                .removeClass(\"active\").filter(\".bbg_xiv-view_\"+defaultView.toLowerCase()).addClass(\"active\");\n        }\n        return defaultView;\n    };\n    \n    jQuery(document).ready(function(){\n        jQuery(\"div.bbg_xiv-gallery_envelope\").each(function(){\n            var gallery=this;\n            var defaultView=bbg_xiv.getDefaultView(jQuery(gallery),null);\n            // prettify Galleries tabs\n            bbg_xiv.prettifyTabs(jQuery(gallery.parentNode).find(\"div.bbg_xiv-container\"),true);\n            // If the schema is not in sessionStorage it will be loaded asynchronously so must use wp.api.loadPromise.done()\n            wp.api.loadPromise.done(function(){\n                var images=bbg_xiv.images[gallery.id]=new wp.api.collections.Media();\n                images.reset(JSON.parse(bbg_xiv[gallery.id+\"-data\"]));\n                bbg_xiv.renderGallery(gallery,defaultView,[\"initial\"]);\n                jQuery( gallery ).closest( 'div.bbg_xiv-gallery' ).addClass( 'bbg_xiv-home_gallery' );\n                jQuery(window).resize();\n            });\n        });\n\n        // wireup the event handlers\n        // wireup the handler for view selection\n        jQuery(\"nav.bbg_xiv-gallery_navbar ul.nav li.dropdown ul.bbg_xiv-view_menu li > a\").click(function(e){\n            var view=this.dataset.view;\n            var jqThis=jQuery(this);\n            var li=jqThis.parent();\n            var select=li.parent();\n            var liSelectView=li.parents(\"li.bbg_xiv-select_view\");\n            var container=jqThis.parents(\"div.bbg_xiv-bootstrap.bbg_xiv-gallery\");\n            var divGallery=container.find(\"div.bbg_xiv-gallery_envelope\")[0];\n            function handleResponse( r ) {\n                if(jqueryLoading){\n                    jQuery.mobile.loading(\"hide\");\n                    jQuery(divGallery).children().detach();\n                }\n                if(r){\n                    galleries.images[view]=bbg_xiv.constructImages(divGallery);\n                    galleries.view=view;\n                    container.find(\"div#\"+divGallery.id+\"-alt_gallery_heading span.bbg_xiv-alt_gallery_heading\").text(title);\n                    bbg_xiv.renderGallery(divGallery,defaultView);\n                }else{\n                    jQuery(divGallery).empty().append('<h1 class=\"bbg_xiv-warning\">'+bbg_xiv_lang[\"Nothing Found\"]+'</h1>');\n                }\n                jQuery(divGallery.parentNode).find(\"nav.navbar form.bbg_xiv-search_form button\").prop(\"disabled\",false);\n            }\n            if([\"Gallery\",\"Carousel\",\"Justified\",\"Tabs\",\"Dense\"].indexOf(view)>=0){\n                // view selected\n                select.find(\"li.bbg_xiv-view\").removeClass(\"active\");\n                li.addClass(\"active\");\n                liSelectView.find(\"a.bbg_xiv-selected_view span\").text(this.textContent);\n                bbg_xiv.renderGallery(divGallery,view);\n            }else{\n                // gallery selected\n                // delete search state if it exists\n                if(bbg_xiv.search[divGallery.id]){\n                    delete bbg_xiv.search[divGallery.id];\n                }\n                container.find(\"div#\"+divGallery.id+\"-alt_gallery_heading\").hide();\n                var title=this.textContent;\n                var galleries=bbg_xiv.galleries[divGallery.id];\n                var galleryOfGalleries=(view!==\"gallery_home\")?false:null;\n                var defaultView=bbg_xiv.getDefaultView(jQuery(divGallery),galleryOfGalleries);\n                select.find(\"li.bbg_xiv-view\").removeClass(\"active\");\n                var liGallery=select.find(\"li.bbg_xiv-view_\"+defaultView.toLowerCase()).addClass(\"active\");\n                liSelectView.find(\"a.bbg_xiv-selected_view span\").text(liGallery.text());\n                select.find(\"li.bbg_xiv-alt_gallery\").removeClass(\"active\");\n                li.addClass(\"active\");\n                if(galleries.images[view]){\n                    // images were previously loaded so just restore  the collection\n                    bbg_xiv.images[divGallery.id]=galleries.images[view];\n                    galleries.view=view;\n                    if(view!==\"gallery_home\"){\n                        container.find(\"div#\"+divGallery.id+\"-alt_gallery_heading span.bbg_xiv-alt_gallery_heading\").text(title);\n                    }\n                    bbg_xiv.renderGallery(divGallery,defaultView);\n                    // update active in gallery tabs\n                    container.find(\"div.bbg_xiv-gallery_tabs_container nav.navbar ul.nav-tabs li\").removeClass(\"active\").find(\"a[data-view='\"+view+\"']\").parent().addClass(\"active\");\n                    if ( view !== 'gallery_home' ) {\n                        jqThis.closest( 'div.bbg_xiv-gallery' ).removeClass( 'bbg_xiv-home_gallery' );\n                    } else {\n                        jqThis.closest( 'div.bbg_xiv-gallery' ).addClass( 'bbg_xiv-home_gallery' );\n                    }\n                    e.preventDefault();\n                    return;\n                }\n                // setup headings\n                jQuery(\"div#\"+divGallery.id+\"-heading\").hide();\n                var jqueryLoading=true;\n                try {\n                    // There is a very rare failure of the following\n                    jQuery(divGallery).empty().append(jQuery.mobile.loading(\"show\",{text:\"Loading... please wait.\",textVisible:true,textonly:false}));\n                } catch ( error ) {\n                    console.log( error );\n                    //console.log(\"jQuery.mobile.loading._widget=\",jQuery.mobile.loading._widget);\n                    jQuery(divGallery).empty().append('<h1 class=\"bbg_xiv-info\">Loading... please wait.</h1>');\n                    jQuery.mobile.loading._widget=undefined;\n                    jqueryLoading=false;\n                }\n                var specifiers=this.dataset.specifiers;\n                // extract individual gallery parameters\n                // translation maps for gallery shortcode parameter names and values to WP REST API option names and values\n                var nameMap={\n                    id:\"parent\",\n                    ids:\"include\",\n                    bb_tags:\"bb-tags\"\n                };\n                // really should have a value map per parameter name but fortunately there are no overlaps\n                var valueMap={\n                    ASC:\"asc\",\n                    DESC:\"desc\"\n                };\n                var matches    = specifiers.match( /(\\w+)=\"([^\"]+)\"/g );\n                var parameters = {};\n                var ids        = false;\n                matches.forEach( function( match ) {\n                    var specifier = match.match( /(\\w+)=\"([^\"]+)\"/ );\n                    // translate gallery shortcode parameters to WP REST API options\n                    parameters[nameMap[specifier[1]]?nameMap[specifier[1]]:specifier[1]]=valueMap[specifier[2]]?valueMap[specifier[2]]:specifier[2];\n                    if ( specifier[1] === \"ids\" ) {\n                        ids = true;\n                    }\n                });\n                if ( ids && ! parameters.orderby ) {\n                    // for ids use the explicit order in ids\n                    parameters.orderby = 'include';\n                }\n                var form=jqThis.parents(\"div.navbar-collapse\").first().find(\"form[role='search']\");\n                // uses the WP REST API - requires the WP REST API plugin\n                var images=bbg_xiv.images[divGallery.id]=new wp.api.collections.Media();\n                images.once(\"sync\",function(){\n                    // the sync event will occur once only on the Backbone fetch of the collection\n                    handleResponse(!!this.length);\n                },images);\n                // get the collection specified by the parameters\n                parameters.per_page=bbg_xiv.wpRestApiMaxPerPage;\n                images.fetch({\n                    data:parameters,\n                    success: function() {\n                    },\n                    error: function( c, r ) {\n                        console.log(\"error:r=\",r);\n                        handleResponse(false);\n                    }\n                });\n                // update active in gallery tabs\n                jqThis.parents(\"div.bbg_xiv-bootstrap.bbg_xiv-gallery\").find(\"div.bbg_xiv-gallery_tabs_container nav.navbar ul.nav-tabs li\").removeClass(\"active\")\n                    .find(\"a[data-view='\"+view+\"']\").parent().addClass(\"active\");\n                if ( view !== 'gallery_home' ) {\n                    jqThis.closest( 'div.bbg_xiv-gallery' ).removeClass( 'bbg_xiv-home_gallery' );\n                } else {\n                    jqThis.closest( 'div.bbg_xiv-gallery' ).addClass( 'bbg_xiv-home_gallery' );\n                }\n            }\n            e.preventDefault();\n        });\n        // wireup Galleries tabs \n        jQuery(\"div.bbg_xiv-gallery_tabs_container nav.navbar ul.nav-tabs li a[data-view^='gallery_']\").click(function(e){\n            jQuery(this).parents(\"div.bbg_xiv-bootstrap.bbg_xiv-gallery\")\n                .find(\"nav.bbg_xiv-gallery_navbar ul.nav li.dropdown ul.bbg_xiv-view_menu li > a[data-view='\"+this.dataset.view+\"']\").click();\n            e.preventDefault();\n        });\n        // wireup the handler for searching\n        jQuery(\"form.bbg_xiv-search_form input[type='text']\").keypress(function(e){\n            if(e.which===13){\n                // need to do this to hide virtual keyboard on mobile devices\n                jQuery(this).blur();\n            }\n        });\n        jQuery(\"form.bbg_xiv-search_form button\").each(function(){\n            var query;\n            var offset;\n            var page;\n            var count=Number.MAX_SAFE_INTEGER;\n            var pages=Number.MAX_SAFE_INTEGER;\n            jQuery(this).click(function(e){\n                var searchLimit = parseInt( bbg_xiv.bbg_xiv_max_search_results, 10 );\n                if ( searchLimit > bbg_xiv.wpRestApiMaxPerPage ) {\n                    searchLimit = bbg_xiv.wpRestApiMaxPerPage;\n                }\n                var searchBtn=jQuery(this);\n                searchBtn.prop(\"disabled\",true);\n                var startSearch=\"search images on site\";\n                var continueSearch=\"continue current search\";\n                var divGallery=searchBtn.parents(\"div.bbg_xiv-gallery\").find(\"div.bbg_xiv-gallery_envelope\")[0];\n                var form=searchBtn.parents(\"form[role='search']\");\n                var input=form.find(\"input[type='text']\");\n                var value=input.val();\n                var postData;\n                if(value){\n                    // new search\n                    query=value;\n                    offset=0;\n                    page=1;\n                    // start new search history\n                    bbg_xiv.search[divGallery.id]={history:[],index:-1,done:false};\n                }else if(typeof query===\"undefined\"){\n                    e.preventDefault();\n                    return;\n                }\n                // setup headings\n                jQuery(\"div#\"+divGallery.id+\"-alt_gallery_heading\").hide();\n                var jqueryLoading=true;\n                try {\n                    // There is a very rare failure of the following\n                    jQuery(divGallery).empty().append(jQuery.mobile.loading(\"show\",{text:\"Loading... please wait.\",textVisible:true,textonly:false}));\n                } catch ( error) {\n                    console.log( error );\n                    //console.log(\"jQuery.mobile.loading._widget=\",jQuery.mobile.loading._widget);\n                    jQuery(divGallery).empty().append('<h1 class=\"bbg_xiv-info\">Loading... please wait.</h1>');\n                    jQuery.mobile.loading._widget=undefined;\n                    jqueryLoading=false;\n                }\n                jQuery(divGallery).parent().find(\"div.bbg_xiv-search_header\").hide();\n                function handleResponse(r){\n                    if(jqueryLoading){\n                        jQuery.mobile.loading(\"hide\");\n                        jQuery(divGallery).children().detach();\n                    }\n                    if(r){\n                        var images=bbg_xiv.constructImages(divGallery);\n                        var prevOffset=offset;\n                        var prevQuery=query;\n                        var heading=jQuery(\"div#\"+divGallery.id+\"-heading\");\n                        var search=bbg_xiv.search[divGallery.id];\n                        if (page <= pages ) {\n                            // this search has more images\n                            offset+=searchLimit;\n                            input.val(\"\").attr(\"placeholder\",continueSearch);\n                            heading.find(\"button.bbg_xiv-search_scroll_right\").attr(\"disabled\",false);\n                        } else {\n                            // all search results have been returned\n                            search.done=true;\n                            input.attr(\"placeholder\",startSearch).val(query);\n                            query=undefined;\n                            offset=undefined;\n                            heading.find(\"button.bbg_xiv-search_scroll_right\").attr(\"disabled\",true);\n                        }\n                        // search results uses a heading to show status\n                        heading.find(\"span.bbg_xiv-search_heading_first\").text(bbg_xiv_lang[\"Search Results for\"]+\" \\\"\"+prevQuery+\"\\\"\");\n                        var title;\n                        title = bbg_xiv_lang.Page + ' ' + ( page - 1 ) + ' ' + bbg_xiv_lang.of + ' ' + ( pages !== Number.MAX_SAFE_INTEGER ? pages : '?' );\n                        heading.find(\"span.bbg_xiv-search_heading_second\").text(title);\n                        // maintain a history of all images returned by this search\n                        search.history.push({images:images,title:title});\n                        search.index=search.history.length-1;\n                        var defaultView = bbg_xiv.getDefaultView( jQuery( divGallery ), null );\n                        bbg_xiv.renderGallery( divGallery, defaultView );\n                        heading.find(\"button.bbg_xiv-search_scroll_left\").attr(\"disabled\",search.index===0);\n                    }else{\n                        jQuery(divGallery).empty().append('<h1 class=\"bbg_xiv-warning\">'+bbg_xiv_lang[\"Nothing Found\"]+'</h1>');\n                    }\n                    var liSelectView=jQuery(divGallery.parentNode).find(\"nav.bbg_xiv-gallery_navbar ul.nav li.bbg_xiv-select_view\");\n                    var liFirst=liSelectView.find(\"ul.bbg_xiv-view_menu li.bbg_xiv-view\").removeClass(\"active\").filter(\".bbg_xiv-view_gallery\").addClass(\"active\");\n                    liSelectView.find(\"a.bbg_xiv-selected_view span\").text(liFirst.text());\n                    searchBtn.prop(\"disabled\",false);\n                }\n                // uses the WP REST API\n                var images=bbg_xiv.images[divGallery.id]=new wp.api.collections.Media();\n                images.once(\"sync\",function(){\n                    // the sync event will occur once only on the Backbone fetch of the collection\n                    handleResponse(!!this.length);\n                },images);\n                // get the next part of the multi-part search result as specified by page\n                images.fetch({\n                    data:{\n                        search:query,\n                        // 'bb-tags':query,\n                        page:page++,\n                        per_page:searchLimit\n                    },\n                    success:function(c,r,o){\n                        // set the page variable from the page query parameter of the next page url in the HTTP header field \"Link\"\n                        var link=o.xhr.getResponseHeader(\"link\");\n                        if(link){\n                            var matches=link.match(/(\\?|&)page=(\\d+)(&[^>]+>;|>;)\\s+rel=\"next\"/);\n                            if(matches&&matches.length===4&&jQuery.isNumeric(matches[2])){\n                                page = parseInt( matches[2], 10 );\n                            }else{\n                                // no next page means search is complete\n                            }\n                        }else{\n                            // no HTTP \"Link\" header field means only one page so search is complete\n                        }\n                        // get count and pages from the HTTP header fields: \"X-WP-Total\", \"X-WP-TotalPages\" via wp-api.js\n                        count=images.state.totalObjects;\n                        pages=images.state.totalPages;\n                    },\n                    error: function( c, r ) {\n                        console.log(\"error:r=\",r);\n                        handleResponse(false);\n                    }\n                });\n                searchBtn.closest( 'div.bbg_xiv-gallery' ).removeClass( 'bbg_xiv-home_gallery' );\n                e.preventDefault();\n            });\n        });\n        jQuery(\"button.bbg_xiv-home\").click(function(e){\n            jQuery(this).parents(\"div.bbg_xiv-bootstrap.bbg_xiv-gallery\")\n                .find(\"nav.bbg_xiv-gallery_navbar ul.nav li.dropdown ul.bbg_xiv-view_menu li > a[data-view='gallery_home']\").click();\n            e.preventDefault();\n        });\n        jQuery( 'button.bbg_xiv-fullscreen' ).click(function() {\n            var $gallery = jQuery( this ).closest( 'div.bbg_xiv-gallery' );\n            if ( $gallery.hasClass( 'bbg_xiv-fullscreen_gallery' ) ) {\n                $gallery.removeClass( 'bbg_xiv-fullscreen_gallery' ).find( 'button.bbg_xiv-fullscreen' ).attr( 'title', bbg_xiv_lang['expand gallery to full-screen'] );\n                jQuery( 'html' ).removeClass( 'bbg_xiv-fullscreen_gallery' );\n            } else {\n                $gallery.addClass( 'bbg_xiv-fullscreen_gallery' ).find( 'button.bbg_xiv-fullscreen' ).attr( 'title', bbg_xiv_lang['shrink gallery from full-screen'] );\n                jQuery( 'html' ).addClass( 'bbg_xiv-fullscreen_gallery' );\n            }\n            jQuery( window ).resize();\n        });\n        jQuery( 'button.bbg_xiv-titles' ).click(function() {\n            var $this             = jQuery( this );\n            var $galleryContainer = $this.closest( 'div.bbg_xiv-bootstrap.bbg_xiv-gallery' );\n            var $container        = $galleryContainer.find( 'div.bbg_xiv-flex_container' );\n            if ( $container.length ) {\n                var $figure  = $container.find( 'div.bbg_xiv-flex_item figure' );\n                var $caption = $figure.find( 'figcaption' );\n                if ( $galleryContainer.hasClass( 'bbg_xiv-caption_visible' ) ) {\n                    $caption.hide( 1000 );\n                    $galleryContainer.removeClass( 'bbg_xiv-caption_visible' );\n                    $this.attr( 'title', bbg_xiv_lang['show titles'] );\n                } else {\n                    $caption.show( 1000 );\n                    $galleryContainer.addClass( 'bbg_xiv-caption_visible' );\n                    $this.attr( 'title', bbg_xiv_lang['hide titles'] );\n                }\n                if ( $container.hasClass( 'bbg_xiv-contain' ) ) {\n                    // in tiles contain mode center image if title not displayed\n                    if ( $galleryContainer.hasClass( 'bbg_xiv-caption_visible' ) ) {\n                        $figure.find( 'img' ).removeClass( 'bbg_xiv-vertical_center' );\n                    }else{\n                        $figure.find( 'img' ).addClass( 'bbg_xiv-vertical_center' );\n                    }\n                }\n                return;\n            }\n            $container = $galleryContainer.find( 'div.bbg_xiv-justified_container' );\n            if ( $container.length ) {\n                if ( $galleryContainer.hasClass( 'bbg_xiv-caption_visible' ) ) {\n                    $galleryContainer.removeClass( 'bbg_xiv-caption_visible' );\n                    $this.attr( 'title', bbg_xiv_lang['show captions'] );\n                } else {\n                    $galleryContainer.addClass( 'bbg_xiv-caption_visible' );\n                    $this.attr( 'title', bbg_xiv_lang['hide captions'] );\n                }\n                window.setTimeout( function() {\n                    var $caption = $container.find( 'div.caption' );\n                    if ( $galleryContainer.hasClass( 'bbg_xiv-caption_visible' ) ) {\n                        $caption.css( { display: 'block', opacity: '0.7' } );\n                    } else {\n                        $caption.css( { display: 'none',  opacity: '0.0' } );\n                    }\n                }, 1000 );\n            }\n        });\n        // wireup the handler for setting options\n        jQuery(\"button.bbg_xiv-configure\").click(function(e){\n            divConfigure.find(\"input#bbg_xiv-carousel_delay\").val(bbg_xiv.bbg_xiv_carousel_interval);\n            divConfigure.find(\"input#bbg_xiv-min_image_width\").val(bbg_xiv.bbg_xiv_flex_min_width);\n            divConfigure.find( 'input#bbg_xiv-miro_row_height' ).val( bbg_xiv.bbg_xiv_miro_row_height );\n            divConfigure.find(\"input#bbg_xiv-max_search_results\").val(bbg_xiv.bbg_xiv_max_search_results);\n            divConfigure.find(\"input#bbg_xiv-columns_in_dense_view\").val(bbg_xiv.bbg_xiv_flex_number_of_dense_view_columns);\n            divConfigure.find(\"input[name='bbg_xiv-default_view']\").prop(\"checked\",false);\n            if(bbg_xiv.usingServerDefaultView===false){\n                divConfigure.find(\"input[name='bbg_xiv-default_view'][value='\"+bbg_xiv.bbg_xiv_default_view+\"']\").prop(\"checked\",true);\n            }\n            divConfigure.find(\"input[name='bbg_xiv-bandwidth']\").prop(\"checked\",false);\n            divConfigure.find(\"input[name='bbg_xiv-bandwidth'][value='\"+bbg_xiv.bbg_xiv_bandwidth+\"']\").prop(\"checked\",true);\n            divConfigure.find(\"input[name='bbg_xiv-interface']\").prop(\"checked\",false);\n            divConfigure.find(\"input[name='bbg_xiv-interface'][value='\"+bbg_xiv.bbg_xiv_interface+\"']\").prop(\"checked\",true);\n            var gallery=jQuery(this).parents(\"div.bbg_xiv-gallery\");\n            var outer=gallery.find(\"div.bbg_xiv-configure_outer\");\n            outer.show();\n            var inner=gallery.find(\"div.bbg_xiv-configure_inner\");\n            inner.show();\n            e.preventDefault();\n        });\n        var divConfigure=jQuery(\".bbg_xiv-configure_inner\");\n        divConfigure.find( 'input[type=\"number\"]#bbg_xiv-max_search_results' ).change(function() {\n            // max seems to be broken so fix with javascript\n            var jqThis=jQuery(this);\n            var max     = parseInt( jqThis.val(), 10 );\n            var attrMax = parseInt( jqThis.attr( 'max' ), 10 );\n            if ( attrMax > bbg_xiv.wpRestApiMaxPerPage ) {\n                // WP REST API requires that per_page be between 1 and 100 inclusive\n                attrMax = bbg_xiv.wpRestApiMaxPerPage;\n            }\n            if(max>attrMax){\n                jqThis.val(attrMax);\n            }\n        });\n        divConfigure.find( 'button.bbg_xiv-configure_close,button.bbg_xiv-cancel_options' ).click(function() {\n            var gallery=jQuery(this).parents(\"div.bbg_xiv-gallery\");\n            var outer=gallery.find(\"div.bbg_xiv-configure_outer\");\n            outer.hide();\n            var inner=gallery.find(\"div.bbg_xiv-configure_inner\");\n            inner.hide();\n        });\n        divConfigure.find(\"button.bbg_xiv-help_options\").click(function(e){\n            window.open(bbg_xiv.helpOptionsUrl,\"_blank\");\n            e.preventDefault();\n        });\n        divConfigure.find(\"button.bbg_xiv-save_options\").click(function(e){\n            // save the options\n            bbg_xiv.bbg_xiv_carousel_interval=divConfigure.find(\"input#bbg_xiv-carousel_delay\").val();\n            bbg_xiv.bbg_xiv_flex_min_width=divConfigure.find(\"input#bbg_xiv-min_image_width\").val();\n            bbg_xiv.bbg_xiv_miro_row_height = divConfigure.find( 'input#bbg_xiv-miro_row_height' ).val();\n            bbg_xiv.bbg_xiv_max_search_results=divConfigure.find(\"input#bbg_xiv-max_search_results\").val();\n            bbg_xiv.bbg_xiv_flex_number_of_dense_view_columns=divConfigure.find(\"input#bbg_xiv-columns_in_dense_view\").val();\n            var defaultView=divConfigure.find(\"input[name='bbg_xiv-default_view']:checked\").val();\n            if(defaultView){\n                bbg_xiv.bbg_xiv_default_view=defaultView;\n                bbg_xiv.usingServerDefaultView=false;\n            }else{\n                bbg_xiv.usingServerDefaultView=true;\n            }\n            bbg_xiv.bbg_xiv_bandwidth=divConfigure.find(\"input[name='bbg_xiv-bandwidth']:checked\").val();\n            bbg_xiv.bbg_xiv_interface=divConfigure.find(\"input[name='bbg_xiv-interface']:checked\").val();\n            var cookie={\n                bbg_xiv_carousel_interval:bbg_xiv.bbg_xiv_carousel_interval,\n                bbg_xiv_flex_min_width:bbg_xiv.bbg_xiv_flex_min_width,\n                bbg_xiv_miro_row_height: bbg_xiv.bbg_xiv_miro_row_height,\n                bbg_xiv_max_search_results:bbg_xiv.bbg_xiv_max_search_results,\n                bbg_xiv_flex_number_of_dense_view_columns:bbg_xiv.bbg_xiv_flex_number_of_dense_view_columns,\n                bbg_xiv_bandwidth:bbg_xiv.bbg_xiv_bandwidth,\n                bbg_xiv_interface:bbg_xiv.bbg_xiv_interface\n            };\n            if(bbg_xiv.usingServerDefaultView===false){\n                cookie.bbg_xiv_default_view=bbg_xiv.bbg_xiv_default_view;\n            }\n            cookie=JSON.stringify(cookie);\n            bbg_xiv.setCookie(\"bbg_xiv\",cookie,30);\n            bbg_xiv.getOptionsFromCookie();\n            bbg_xiv.calcBreakpoints();\n            var gallery=jQuery(this).parents(\"div.bbg_xiv-gallery\");\n            var outer=gallery.find(\"div.bbg_xiv-configure_outer\");\n            outer.hide();\n            var inner=gallery.find(\"div.bbg_xiv-configure_inner\");\n            inner.hide();\n            // redisplay the \"Gallery\" view using the new option values\n            bbg_xiv.resetGallery(jQuery(this).parents(\"div.bbg_xiv-gallery\"));\n            e.preventDefault();\n        });\n        jQuery(\"button.bbg_xiv-help\").click(function(e){\n            var view = jQuery( this ).closest( 'div.navbar-collapse' ).find( 'ul.navbar-nav li.bbg_xiv-select_view ul.bbg_xiv-view_menu li.bbg_xiv-view.active a' ).data( 'view' );\n            window.open( bbg_xiv.docUrl + '#view-' + view.toLowerCase(), '_blank' );\n            this.blur();\n            e.preventDefault();\n        });\n        // wireup the handler for scrolling through search results\n        jQuery( 'div.bbg_xiv-search_header button.bbg_xiv-search_scroll_left,div.bbg_xiv-search_header button.bbg_xiv-search_scroll_right' ).click(function() {\n            var jqThis = jQuery( this );\n            var heading=jqThis.parents(\"div.bbg_xiv-search_header\");\n            var id=heading.attr(\"id\").replace(\"-heading\",\"\");\n            var gallery=heading.parents(\"div.bbg_xiv-gallery\");\n            var search=bbg_xiv.search[id];\n            if(jqThis.hasClass(\"bbg_xiv-search_scroll_left\")){\n                if(search.index>0){\n                    if(!--search.index){\n                        jqThis.attr(\"disabled\",true);\n                    }\n                    heading.find(\"button.bbg_xiv-search_scroll_right\").attr(\"disabled\",false);\n                }else{\n                }\n            }else{\n                if(search.index<search.history.length-1){\n                    ++search.index;\n                    if(search.index===search.history.length-1&&search.done){\n                        heading.find(\"button.bbg_xiv-search_scroll_right\").attr(\"disabled\",true);\n                    }\n                    heading.find(\"button.bbg_xiv-search_scroll_left\").attr(\"disabled\",false);\n                }else{\n                    // load the next part of the multi-part search\n                    gallery.find(\"nav.navbar form.bbg_xiv-search_form button[type='submit']\").click();\n                    return;\n                }\n            }\n            if(search.index>=0&&search.index<search.history.length){\n                var history=search.history[search.index];\n                bbg_xiv.images[id]=history.images;\n                heading.find(\"span.bbg_xiv-search_heading_second\").text(history.title);\n                var divGallery  = gallery.find( 'div.bbg_xiv-gallery_envelope' );\n                var defaultView = bbg_xiv.getDefaultView( divGallery, null );\n                bbg_xiv.renderGallery( divGallery[0], defaultView );\n                // reset navbar to \"Gallery\" view\n                var liSelectView=gallery.find(\"nav.bbg_xiv-gallery_navbar ul.nav li.bbg_xiv-select_view\");\n                var liFirst=liSelectView.find(\"ul.bbg_xiv-view_menu li.bbg_xiv-view\").removeClass(\"active\").filter(\".bbg_xiv-view_gallery\").addClass(\"active\");\n                liSelectView.find(\"a.bbg_xiv-selected_view span\").text(liFirst.text());\n            }\n        });\n        // make the \"Images\" brand clickable for mobile devices and send click to the toggle button\n        jQuery(\"a.bbg_xiv-images_brand,a.bbg_xiv-tabs_brand\").click(function(e){\n            var toggle=jQuery(this).siblings(\"button.navbar-toggle\");\n            if(toggle.css(\"display\")!==\"none\"){\n                toggle.click();\n            }\n            e.preventDefault();\n        });\n        // wireup mobile only events\n        jQuery(window).on(\"swipe\",function(e){\n            var carousel=jQuery(\"div.bbg_xiv-gallery_envelope div.carousel\");\n            if(carousel.length){\n                // ignore swipes near carousel slider\n                if(e.pageY>jQuery(\"div.carousel-indicators\").offset().top-50){\n                    return;\n                }\n                if(e.swipestop.coords[0]>e.swipestart.coords[0]){\n                    carousel.find(\"a.left.carousel-control\").click();\n                }else{\n                    carousel.find(\"a.right.carousel-control\").click();\n                }\n                return;\n            }\n            // hide/show title and caption of overlay on swipe\n            var inner=jQuery(\"div.bbg_xiv-dense_inner\");\n            inner.find( '.bbg_xiv-dense_title, .bbg_xiv-dense_caption' ).each(function() {\n                var $this = jQuery( this );\n                var color = $this.css( 'color' );\n                if ( color !== 'transparent' && color !== 'rgba(0, 0, 0, 0)' ) {   // TODO: find safer test for transparent\n                    $this.css({ color: 'transparent',      textShadow: 'none'             });\n                }else{\n                    $this.css({ color: bbg_xiv.titleColor, textShadow: bbg_xiv.titleShadow});\n                }\n            });\n        });\n        jQuery( window ).on( 'orientationchange', function() {\n            var $body = jQuery( 'body' );\n            if ( $body.hasClass( 'admin-bar' ) && jQuery( 'div#wpadminbar' ).css( 'position' ) == 'fixed' ) {\n                $body.addClass( 'bbg_xiv-fixed_admin_bar' );\n            } else {\n                $body.removeClass( 'bbg_xiv-fixed_admin_bar' );\n            }\n            jQuery(\"div.bbg_xiv-gallery\").each(function(){\n                bbg_xiv.resetGallery(jQuery(this));\n            });\n        });\n\n        // If TwentySixteen theme has border then add class to body element to indicate this.\n        var $body            = jQuery( 'body' );\n        var bodyBeforeStyle  = window.getComputedStyle( $body[0], ':before' );\n        if ( bodyBeforeStyle && bodyBeforeStyle.position === 'fixed' && bodyBeforeStyle.zIndex > 0 ) {\n            var height = parseInt( bodyBeforeStyle.height, 10 );\n            if ( height > 8 && height < 64 ) {\n                $body.addClass( 'bbg_xiv-twentysixteen_with_border' );\n            }\n        }\n        if ( $body.hasClass( 'admin-bar' ) && jQuery( 'div#wpadminbar' ).css( 'position' ) == 'fixed' ) {\n            $body.addClass( 'bbg_xiv-fixed_admin_bar' );\n        }\n        \n    });   // jQuery(document).ready(function(){\n\n    //cookie test code\n    //window.alert(\"bbg_xiv_test=\"+bbg_xiv.getCookie(\"bbg_xiv_test\"));\n    //bbg_xiv.setCookie(\"bbg_xiv_test\",window.prompt(\"bbg_xiv_test\",\"null\"));\n}());\n\n"]}